<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Audit 5S</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNGRkVEMDAiLz4KICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiwgMTYpIHNjYWxlKDAuMDAzLCAtMC4wMDMpIHRyYW5zbGF0ZSgtNDE0MCwgLTQxNDApIiBmaWxsPSIjMDAwMDAwIj4KICAgIDxwYXRoIGQ9Ik00MDk3IDY5NzQgYy0xIC0xIC00MyAtNSAtOTIgLTggLTUwIC0yIC05MCAtNSAtOTAgLTYgMCAtMSAtMTYgLTMgLTM1IC01IC03OCAtNiAtMjYyIC00OSAtMzcyIC04NiAtMTE3IC0zOCAtMzEwIC0xMjQgLTMxNiAtMTQwIC0yIC01IC04IC05IC0xNCAtOSAtNiAwIC00MSAtMjAgLTc3IC00NCAtMjU4IC0xNzEgLTQ0NiAtNDAxIC01NDEgLTY2MiAtNTAgLTEzNiAtNDQgLTExOSAtNjAgLTE5NCAtMjMgLTExNSAtMjUgLTE0MCAtMjUgLTMxMCAxIC0xODcgNiAtMjQxIDM5IC0zOTcgMTMgLTYwIDQyIC0xNTQgNjMgLTIwMiAxMiAtMjkgMjMgLTU5IDIzIC02NiAwIC03IDcgLTE4IDE1IC0yNSA5IC03IDEzIC0xNSAxMSAtMTggLTMgLTIgMTAgLTI5IDI5IC01OCAxOSAtMzAgMzUgLTU3IDM1IC02MCAwIC0yIDQgLTEwIDEwIC0xNyA1IC03IDI5IC0zNyA1MiAtNjcgNjAgLTc5IDExMiAtMTMzIDE5OCAtMjA1IDE3MyAtMTQ0IDQxMCAtMjY5IDY3NSAtMzU0IDU1IC0xOCAxMDcgLTM1IDExNSAtMzggMTYgLTcgMzAgLTExIDU4IC0xNyA5IC0zIDE3IC01IDE3IC02IDAgLTEgNyAtMyAxNSAtNSA4IC0xIDU2IC0xNSAxMDYgLTI5IDUwIC0xNCAxMTYgLTMyIDE0NSAtNDAgMTI0IC0zNCAyMDUgLTU3IDIxOSAtNjMgOCAtNCAyMCAtOCAyNSAtOCA2IC0xIDE3IC01IDI1IC04IDggLTMgNDQgLTE1IDgwIC0yNyAzNiAtMTIgNzkgLTI4IDk1IC0zNSA0NiAtMTkgNzkgLTMyIDkwIC0zNiAzMCAtMTAgMTk1IC05NSAyNDIgLTEyNSA3MyAtNDYgMTY2IC0xNDQgMTk0IC0yMDIgMTMgLTI2IDI1IC00OSAyOCAtNTIgMyAtMyA4IC0xNCAxMCAtMjUgOSAtNTMgLTExIC01MCA0MjQgLTUwIDIyMyAwIDQwOCAzIDQxMiA2IDggOCAtNTkgMjA3IC05NyAyODkgLTI4IDYwIC0xMjUgMjI4IC0xMzggMjQwIC00IDMgLTE5IDIzIC0zNSA0NSAtNzQgMTAwIC0xOTIgMjE1IC0zMTAgMzAzIC0zOCAyOCAtNzUgNTYgLTgyIDYyIC03IDUgLTE1IDEwIC0xOSAxMCAtNCAwIC0xNSA2IC0yMyAxNCAtNDAgMzYgLTM3NyAxOTQgLTQ1MSAyMTEgLTggMiAtNjggMjIgLTEzMiA0NCAtNjUgMjIgLTExOCAzNyAtMTE4IDM0IDAgLTMgLTYgLTEgLTEzIDUgLTcgNiAtMjQgMTMgLTM3IDE2IC0xNCAzIC00MSAxMCAtNjAgMTYgLTE5IDYgLTQyIDEzIC01MCAxNSAtNjMgMTYgLTE2OSA0OCAtMTg1IDU0IC0xMSA1IC01NCAxOCAtOTUgMzAgLTQxIDEyIC04MiAyNSAtOTAgMjggLTggNCAtMTcgNyAtMjAgOCAtOTYgMjQgLTI5NiAxMTMgLTM4OCAxNzEgLTc4IDUwIC0xNTUgMTI3IC0yMDIgMjAxIC0yMiAzNCAtNDAgNjUgLTQwIDY3IDAgMyAtNSAxNyAtMTIgMzMgLTYgMTUgLTEyIDMzIC0xMyAzOCAtMiA2IC03IDI4IC0xMyA1MCAtMzIgMTIwIC0zNyAzMjggLTEwIDQyNSAxMCAzNiAyMSA3NCAyMyA4NSAxOSA4MyAxNDEgMjQ4IDI0MSAzMjUgNDYgMzYgMTU2IDk5IDE4NCAxMDUgMyAxIDE5IDcgMzUgMTQgMjggMTMgMTA2IDM2IDE1MCA0NiAxMTkgMjggNDc0IDI3IDU3NSAwIDggLTIgMzEgLTcgNTAgLTEwIDU1IC05IDIwNCAtNjIgMjY3IC05NCA5NCAtNDggMTk2IC0xMjggMjU4IC0yMDIgMjQgLTMwIDEwNSAtMTYwIDEwNSAtMTcwIDAgLTQgNCAtMTggOSAtMzEgNSAtMTMgOSAtMjYgMTAgLTMwIDEgLTQgOCAtMjMgMTcgLTQzIDggLTE5IDE0IC0zNyAxNCAtNDAgMCAtMyAwIC02IDEgLTcgOCAtMjcgMjMgLTEzMyAyOCAtMjA0IDEgLTggMTAzIC0xMSAzNjQgLTEwIGwzNjIgMSAtMiAxMDUgYy0xIDU4IC00IDEyMyAtOCAxNDUgLTMgMjIgLTggNTQgLTEwIDcwIC0yIDE3IC00IDMwIC01IDMwIC0xIDAgLTMgNyAtNSAxNSAtNTQgMjU4IC0xODUgNDk4IC0zNzcgNjkyIC01MyA1NCAtMTAyIDk4IC0xMDggOTggLTUgMCAtMTAgNCAtMTAgOCAwIDEyIC0xNzQgMTI0IC0yNzIgMTc1IC00OSAyNSAtODggNDQgLTg4IDQyIDAgLTIgLTI0IDcgLTU0IDIwIC0yOSAxMyAtNjIgMjUgLTcyIDI3IC0xMCAyIC0yMSA1IC0yNCA4IC02IDYgLTE1MCA0NyAtMTkwIDU0IC0xNCAzIC01MCAxMCAtODAgMTYgLTMwIDYgLTcxIDEzIC05MCAxNiAtMTkgMiAtNTEgNyAtNzAgOSAtODIgMTMgLTQxNCAyNyAtNDIzIDE5eiIvPgogICAgPHBhdGggZD0iTTI0MzIgMzMzMiBsLTE0MiAtMyA0IC0yNzIgYzIgLTE0OSA2IC0yODMgOSAtMjk3IDQgLTE0IDggLTQxIDExIC02MCA2IC00OCAyNCAtMTM1IDM4IC0xODQgNiAtMjMgMTIgLTQ2IDE0IC01MyAzIC0xNSA2MiAtMTY5IDczIC0xOTEgNSAtMTAgMjEgLTQyIDM2IC03MiAxNTEgLTI5OSA0MjIgLTU0OSA3NjAgLTcwMiAxMTYgLTUyIDMwNCAtMTEzIDQxMCAtMTM0IDExIC0yIDQzIC04IDcwIC0xNCAxMTMgLTIzIDI4NyAtNDAgNDUzIC00NCBsMTIyIC0zIDAgMzM4IDAgMzM5IC03MiAxIGMtNDAgMCAtODYgMiAtMTAzIDQgLTE2IDIgLTUwIDYgLTc1IDkgLTU0IDYgLTg4IDEyIC0xNTUgMjggLTI3IDcgLTUyIDEzIC01NSAxMyAtNTQgOSAtMjk4IDEyMCAtMzIwIDE0NiAtMyAzIC0yMiAxNyAtNDMgMzEgLTc0IDQ5IC0yMzcgMjE5IC0yMzcgMjQ2IDAgNiAtMyAxMiAtNyAxNCAtMTEgNCAtNDAgNTMgLTcwIDExOCAtMjggNjAgLTc0IDE5MCAtNjggMTkwIDMgMCAxIDEwIC00IDIzIC0xNiA0MiAtMjQgMTQ5IC0yNyAzMzcgLTEgMTAyIC0yIDE4NyAtMyAxOTAgLTEgNSAtMzg1IDcgLTYxOSAyeiIvPgogIDwvZz4KPC9zdmc+Cg==">
    
    <style>
        /* ═══════════════════════════════════════════════════════════════
           POLICE TT NORMS PRO - Sartorius Corporate Font
        ═══════════════════════════════════════════════════════════════ */
        
        @font-face {
            font-family: 'TT Norms Pro';
            src: url('./fonts/TT_Norms_Pro_Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'TT Norms Pro';
            src: url('./fonts/TT_Norms_Pro_Medium.woff2') format('woff2');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'TT Norms Pro';
            src: url('./fonts/TT_Norms_Pro_Bold.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           DESIGN SYSTEM - SARTORIUS OFFICIEL
           Jaune dominant + Blanc + Noir / Gris secondaires
        ═══════════════════════════════════════════════════════════════ */
        
        :root {
            /* Couleurs primaires Sartorius */
            --sartorius-yellow: #FFED00;
            --sartorius-yellow-hover: #E6D600;
            --white: #FFFFFF;
            --black: #000000;
            
            /* Highlight */
            --teal: #00B9BE;
            
            /* Gris Sartorius (secondaires) */
            --gray-5: #F5F5F5;
            --gray-10: #EDEDED;
            --gray-20: #DADADA;
            --gray-30: #C6C6C6;
            --gray-40: #B2B2B2;
            --gray-50: #9D9D9D;
            --gray-60: #878787;
            --gray-70: #6F6F6F;
            --gray-80: #575757;
            --gray-90: #3C3C3C;
            
            /* Traffic Light Colors (scores) */
            --traffic-red: #E60046;
            --traffic-yellow: #FFED00;
            --traffic-green: #00AA46;
            
            /* Scores 1-4 basés sur traffic lights + intermédiaire */
            --score-1: #E60046;
            --score-2: #F59100;  /* Orange Sartorius */
            --score-3: #FFED00;
            --score-4: #00AA46;
            
            /* Typographie - TT Norms Pro */
            --font-family: 'TT Norms Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            
            /* Espacements */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            
            /* Rayons */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           RESET & BASE
        ═══════════════════════════════════════════════════════════════ */
        
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--black);
            background: var(--gray-5);
            min-height: 100vh;
            padding-top: 60px; /* Compenser header fixed */
            padding-bottom: 70px;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           HEADER - Jaune Sartorius dominant
        ═══════════════════════════════════════════════════════════════ */
        
        .header {
            background: var(--sartorius-yellow);
            color: var(--black);
            padding: var(--space-sm) var(--space-md);
            padding-left: var(--space-sm);
            padding-bottom: calc(var(--space-sm) + 4px); /* Espace pour la barre */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 640px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-md);
        }
        
        .header-logo {
            height: 62px;
            width: auto;
        }
        
        .header-right {
            text-align: left;
        }
        
        .header-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            line-height: 1.2;
        }
        
        .header-date {
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--gray-70);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           BARRE DE PROGRESSION - Dans le header
        ═══════════════════════════════════════════════════════════════ */
        
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gray-20);
        }
        
        .progress-fill {
            height: 100%;
            background: var(--black);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           MAIN CONTAINER
        ═══════════════════════════════════════════════════════════════ */
        
        .container {
            max-width: 640px;
            margin: 0 auto;
            padding: var(--space-lg);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           FORM SECTIONS - Informations générales
        ═══════════════════════════════════════════════════════════════ */
        
        .info-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            border: 1px solid var(--gray-20);
        }
        
        .info-section:last-of-type {
            margin-bottom: var(--space-sm);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }
        
        @media (max-width: 480px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }
        
        .form-group label {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--gray-80);
        }
        
        .form-group select,
        .form-group input[type="text"] {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            font-size: var(--font-size-base);
            font-family: inherit;
            color: var(--black);
            background: var(--white);
            border: 2px solid var(--gray-30);
            border-radius: var(--radius-md);
            transition: border-color 0.15s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .form-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23575757' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
            cursor: pointer;
        }
        
        .form-group select:focus,
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--sartorius-yellow);
        }
        
        .form-group select:invalid {
            color: var(--gray-50);
        }
        
        /* Animation shake pour champs manquants */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        
        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 0 rgba(233, 0, 78, 0.5); }
            50% { box-shadow: 0 0 0 8px rgba(233, 0, 78, 0); }
            100% { box-shadow: 0 0 0 0 rgba(233, 0, 78, 0); }
        }
        
        .form-group.missing input,
        .form-group.missing select {
            border-color: var(--traffic-red);
            animation: shake 0.5s ease, highlightPulse 1s ease;
        }
        
        .form-group.missing .form-label {
            color: var(--traffic-red);
        }
        
        /* Erreur sur champ individuel (responsable action) */
        .field-error {
            border-color: var(--traffic-red) !important;
            animation: shake 0.5s ease, highlightPulse 1s ease !important;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           AUTOCOMPLETE AUDITEUR
        ═══════════════════════════════════════════════════════════════ */
        
        .autocomplete-wrapper {
            position: relative;
        }
        
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--gray-30);
            border-top: none;
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .autocomplete-suggestions.visible {
            display: block;
        }
        
        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            border-bottom: 1px solid var(--gray-10);
            transition: background 0.1s ease;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .autocomplete-item:hover,
        .autocomplete-item.active {
            background: var(--gray-10);
        }
        
        .autocomplete-item mark {
            background: var(--sartorius-yellow);
            color: var(--black);
            padding: 0 2px;
            border-radius: 2px;
        }
        
        /* Dark mode */
        body.dark-mode .autocomplete-suggestions {
            background: var(--gray-10);
            border-color: var(--gray-40);
        }
        
        body.dark-mode .autocomplete-item {
            border-bottom-color: var(--gray-30);
        }
        
        body.dark-mode .autocomplete-item:hover,
        body.dark-mode .autocomplete-item.active {
            background: var(--gray-20);
        }
        
        body.dark-mode .autocomplete-item mark {
            background: var(--sartorius-yellow);
            color: #000000;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           SLIDER NIVEAU D'AUDIT
        ═══════════════════════════════════════════════════════════════ */
        
        .level-slider-container {
            margin-top: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .level-slider-container .form-label {
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        .level-slider {
            flex: 1;
            max-width: 200px;
            position: relative;
        }
        
        .level-slider input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: var(--gray-20);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }
        
        .level-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: var(--sartorius-yellow);
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transition: transform 0.1s ease;
        }
        
        .level-slider input[type="range"]::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        
        .level-slider input[type="range"]::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: var(--sartorius-yellow);
            border: none;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        .level-labels {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-xs);
            padding: 0 2px;
        }
        
        .level-labels span {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--gray-50);
            transition: color 0.15s ease;
        }
        
        .level-labels span.active {
            color: var(--black);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           5S SECTIONS - Collapsibles
        ═══════════════════════════════════════════════════════════════ */
        
        .s-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            border: 1px solid var(--gray-20);
            overflow: hidden;
        }
        
        .s-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            background: var(--gray-5);
            border-bottom: 1px solid var(--gray-20);
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        
        .s-header:hover {
            background: var(--gray-10);
        }
        
        .s-section.collapsed .s-header {
            border-bottom: none;
        }
        
        .s-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--sartorius-yellow);
            color: var(--black);
            font-size: var(--font-size-lg);
            font-weight: 700;
            border-radius: var(--radius-md);
            flex-shrink: 0;
            transition: transform 0.15s ease;
        }
        
        .s-header:active .s-badge {
            transform: scale(0.95);
        }
        
        .s-title-group {
            flex: 1;
            min-width: 0;
        }
        
        .s-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--black);
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .s-subtitle {
            font-size: var(--font-size-sm);
            color: var(--gray-60);
        }
        
        .s-score {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--gray-50);
            white-space: nowrap;
        }
        
        .s-score.complete {
            color: var(--traffic-green);
        }
        
        /* Chevron indicateur */
        .s-chevron {
            width: 20px;
            height: 20px;
            color: var(--gray-50);
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }
        
        .s-section.collapsed .s-chevron {
            transform: rotate(-90deg);
        }
        
        /* Corps collapsible */
        .s-body {
            padding: var(--space-sm);
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.2s ease;
            opacity: 1;
        }
        
        .s-section.collapsed .s-body {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            opacity: 0;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           CRITERIA CARDS
        ═══════════════════════════════════════════════════════════════ */
        
        .criteria-card {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
            transition: background-color 0.15s ease;
        }
        
        .criteria-card:last-child {
            margin-bottom: 0;
        }
        
        .criteria-card.scored {
            background: var(--gray-5);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           PASTILLE ACTION
        ═══════════════════════════════════════════════════════════════ */
        
        .action-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--gray-20);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }
        
        .action-badge-label {
            display: inline;
            font-size: 10px;
            color: var(--gray-40);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           PASTILLE INFO
        ═══════════════════════════════════════════════════════════════ */
        
        .info-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: none;
            border: 1.5px solid var(--gray-30);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s ease;
            flex-shrink: 0;
            font-size: 10px;
            font-weight: 600;
            font-style: italic;
            color: var(--gray-40);
            font-family: Georgia, serif;
            margin-left: var(--space-xs);
        }
        
        .info-badge:hover {
            border-color: var(--gray-50);
            color: var(--gray-60);
        }
        
        /* Popup overlay */
        .info-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
        }
        
        .info-popup-overlay.visible {
            display: flex;
        }
        
        .info-popup {
            background: var(--white);
            border-radius: var(--radius-md);
            max-width: 320px;
            width: 100%;
            overflow: hidden;
            animation: popIn 0.2s ease;
        }
        
        .info-popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-10);
            border-bottom: 1px solid var(--gray-20);
        }
        
        .info-popup-title {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--gray-80);
        }
        
        .info-popup-close {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: var(--radius-sm);
            color: var(--gray-50);
        }
        
        .info-popup-close:hover {
            background: var(--gray-20);
            color: var(--gray-80);
        }
        
        .info-popup-body {
            padding: var(--space-md);
            font-size: var(--font-size-sm);
            line-height: 1.6;
            color: var(--gray-70);
        }
        
        .action-badge svg {
            width: 14px;
            height: 14px;
            color: var(--gray-50);
            transition: transform 0.3s ease;
        }
        
        .action-badge .icon-plus {
            display: block;
        }
        
        .action-badge .icon-check {
            display: none;
        }
        
        .action-badge.has-action .icon-plus {
            display: none;
        }
        
        .action-badge.has-action .icon-check {
            display: block;
            animation: popIn 0.3s ease;
        }
        
        @keyframes popIn {
            0% { transform: scale(0) rotate(-45deg); }
            70% { transform: scale(1.2) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .action-badge:hover svg {
            transform: rotate(90deg);
        }
        
        .action-badge.has-action:hover svg {
            transform: none;
        }
        
        .action-badge:hover {
            background: var(--gray-30);
        }
        
        .action-badge.has-action {
            background: var(--sartorius-yellow);
        }
        
        .action-badge.has-action svg {
            color: var(--black);
        }
        
        .action-badge.has-action:hover {
            background: #E6D600;
        }
        
        /* Pulse quand action recommandée (score 0-1) */
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.4); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 6px rgba(255, 152, 0, 0); }
        }
        
        .action-badge.needs-action {
            background: #FF9800;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .action-badge.needs-action svg {
            color: var(--white);
        }
        
        /* Orange fixe pour élévation (score 2) */
        .action-badge.suggest-elevation {
            background: #FF9800;
        }
        
        .action-badge.suggest-elevation svg {
            color: var(--white);
        }
        
        .action-badge.suggest-elevation:hover {
            background: #F57C00;
        }
        
        /* Clignotement rouge pour action incomplète */
        @keyframes incompleteBlink {
            0%, 100% { background: var(--traffic-red); transform: scale(1); }
            50% { background: #FF6B6B; transform: scale(1.15); }
        }
        
        .action-badge.incomplete-action {
            animation: incompleteBlink 0.3s ease-in-out 3;
        }
        
        .action-badge.incomplete-action svg {
            color: var(--white);
        }
        
        /* Label critère avec pastille */
        .criteria-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
        }
        
        .criteria-label {
            flex: 1;
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--gray-80);
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           BLOC ACTION INLINE
        ═══════════════════════════════════════════════════════════════ */
        
        .action-block {
            margin-top: var(--space-sm);
            padding: var(--space-sm);
            background: #FFF8E6;
            border: 1px solid var(--sartorius-yellow);
            border-radius: var(--radius-sm);
            display: none;
        }
        
        .action-block.visible {
            display: block;
            animation: slideDown 0.15s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-4px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .action-type-toggle {
            display: flex;
            gap: 0;
            margin-bottom: var(--space-sm);
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--gray-30);
        }
        
        .action-type-btn {
            flex: 1;
            padding: var(--space-xs) var(--space-sm);
            font-family: inherit;
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--gray-60);
            background: var(--white);
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .action-type-btn:first-child {
            border-right: 1px solid var(--gray-30);
        }
        
        .action-type-btn:hover {
            background: var(--gray-10);
        }
        
        .action-type-btn.selected {
            background: var(--sartorius-yellow);
            color: var(--black);
            font-weight: 600;
        }
        
        .action-row {
            display: flex;
            gap: var(--space-sm);
        }
        
        .action-field {
            flex: 1;
        }
        
        .action-field input {
            width: 100%;
            padding: var(--space-xs) var(--space-sm);
            font-family: inherit;
            font-size: var(--font-size-sm);
            border: 1px solid var(--gray-30);
            border-radius: var(--radius-sm);
            background: var(--white);
            transition: border-color 0.15s ease;
        }
        
        .action-field input::placeholder {
            color: var(--gray-40);
        }
        
        .action-field input:focus {
            outline: none;
            border-color: var(--sartorius-yellow);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           BOUTONS DE SCORE - Échelle 0-4 (Traffic Light System)
        ═══════════════════════════════════════════════════════════════ */
        
        .score-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-xs);
        }
        
        .score-btn {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 52px;
            padding: var(--space-xs);
            background: var(--white);
            border: 2px solid var(--gray-30);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.15s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .score-btn:active {
            transform: scale(0.96);
        }
        
        .score-btn .score-value {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--gray-60);
            line-height: 1;
        }
        
        .score-btn .score-label {
            font-size: 0.65rem;
            color: var(--gray-50);
            margin-top: 2px;
            text-align: center;
            line-height: 1.1;
        }
        
        /* Score 0 - Noir (Non audité / Non applicable) */
        .score-btn[data-score="0"]:hover,
        .score-btn[data-score="0"].selected {
            border-color: var(--gray-90);
            background: var(--gray-90);
        }
        .score-btn[data-score="0"]:hover .score-value,
        .score-btn[data-score="0"]:hover .score-label,
        .score-btn[data-score="0"].selected .score-value,
        .score-btn[data-score="0"].selected .score-label {
            color: var(--white);
        }
        
        /* Score 1 - Rouge */
        .score-btn[data-score="1"]:hover,
        .score-btn[data-score="1"].selected {
            border-color: var(--score-1);
            background: var(--score-1);
        }
        .score-btn[data-score="1"]:hover .score-value,
        .score-btn[data-score="1"]:hover .score-label,
        .score-btn[data-score="1"].selected .score-value,
        .score-btn[data-score="1"].selected .score-label {
            color: var(--white);
        }
        
        /* Score 2 - Orange */
        .score-btn[data-score="2"]:hover,
        .score-btn[data-score="2"].selected {
            border-color: var(--score-2);
            background: var(--score-2);
        }
        .score-btn[data-score="2"]:hover .score-value,
        .score-btn[data-score="2"]:hover .score-label,
        .score-btn[data-score="2"].selected .score-value,
        .score-btn[data-score="2"].selected .score-label {
            color: var(--black);
        }
        
        /* Score 3 - Jaune Sartorius */
        .score-btn[data-score="3"]:hover,
        .score-btn[data-score="3"].selected {
            border-color: var(--score-3);
            background: var(--score-3);
        }
        .score-btn[data-score="3"]:hover .score-value,
        .score-btn[data-score="3"]:hover .score-label,
        .score-btn[data-score="3"].selected .score-value,
        .score-btn[data-score="3"].selected .score-label {
            color: var(--black);
        }
        
        /* Score 4 - Vert */
        .score-btn[data-score="4"]:hover,
        .score-btn[data-score="4"].selected {
            border-color: var(--score-4);
            background: var(--score-4);
        }
        .score-btn[data-score="4"]:hover .score-value,
        .score-btn[data-score="4"]:hover .score-label,
        .score-btn[data-score="4"].selected .score-value,
        .score-btn[data-score="4"].selected .score-label {
            color: var(--white);
        }
        
        /* Indicateur de sélection */
        .score-btn.selected::after {
            content: '✓';
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 9px;
            font-weight: 700;
        }
        .score-btn[data-score="0"].selected::after,
        .score-btn[data-score="1"].selected::after,
        .score-btn[data-score="4"].selected::after {
            color: var(--white);
        }
        .score-btn[data-score="2"].selected::after,
        .score-btn[data-score="3"].selected::after {
            color: var(--black);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           COMMENTAIRE & PHOTO (optionnels)
        ═══════════════════════════════════════════════════════════════ */
        
        .optional-section {
            margin-top: var(--space-sm);
        }
        
        .optional-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            font-size: var(--font-size-sm);
            color: var(--gray-60);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: color 0.15s ease;
        }
        
        .optional-toggle:hover {
            color: var(--black);
        }
        
        .optional-toggle svg {
            width: 16px;
            height: 16px;
        }
        
        .optional-content {
            display: none;
            padding: var(--space-sm);
            padding-top: 0;
        }
        
        .optional-content.visible {
            display: block;
        }
        
        .optional-content textarea {
            width: 100%;
            padding: var(--space-sm);
            font-family: inherit;
            font-size: var(--font-size-sm);
            color: var(--black);
            background: var(--white);
            border: 1px solid var(--gray-30);
            border-radius: var(--radius-sm);
            resize: vertical;
            min-height: 60px;
        }
        
        .optional-content textarea:focus {
            outline: none;
            border-color: var(--sartorius-yellow);
        }
        
        .photo-upload {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }
        
        .photo-upload input[type="file"] {
            display: none;
        }
        
        .photo-upload-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            font-size: var(--font-size-sm);
            color: var(--gray-70);
            background: var(--gray-10);
            border: 1px dashed var(--gray-40);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .photo-upload-btn:hover {
            border-color: var(--sartorius-yellow);
            color: var(--black);
        }
        
        .photo-preview {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            margin-top: var(--space-sm);
        }
        
        .photo-thumb {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--gray-30);
        }
        
        .photo-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            background: var(--traffic-red);
            color: var(--white);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           BANDEAU BAS - Score + Bouton
        ═══════════════════════════════════════════════════════════════ */
        
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-sm) var(--space-lg);
            background: var(--white);
            border-top: 1px solid var(--gray-20);
            z-index: 99;
        }
        
        .bottom-bar {
            max-width: 640px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .score-display {
            display: flex;
            align-items: baseline;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-5);
            border-radius: var(--radius-md);
            white-space: nowrap;
        }
        
        .score-display .score-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--black);
        }
        
        .score-display .score-max {
            font-size: var(--font-size-sm);
            color: var(--gray-50);
        }
        
        .score-display .score-percent {
            font-size: var(--font-size-sm);
            font-weight: 700;
            padding: 2px var(--space-xs);
            border-radius: var(--radius-sm);
            margin-left: var(--space-xs);
        }
        
        .score-percent.low { 
            background: var(--score-1); 
            color: var(--white);
        }
        .score-percent.medium { 
            background: var(--score-2); 
            color: var(--black);
        }
        .score-percent.good { 
            background: var(--score-3); 
            color: var(--black);
        }
        .score-percent.excellent { 
            background: var(--score-4); 
            color: var(--white);
        }
        
        .submit-btn {
            flex: 1;
            padding: var(--space-md) var(--space-lg);
            font-family: inherit;
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--white);
            background: var(--black);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background-color 0.15s ease, transform 0.1s ease;
        }
        
        .submit-btn:hover:not(:disabled) {
            background: var(--gray-80);
        }
        
        .submit-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .submit-btn:disabled {
            background: var(--gray-40);
            cursor: not-allowed;
        }
        
        .submit-btn.ready {
            background: var(--sartorius-yellow);
            color: var(--black);
        }
        
        .submit-btn.ready:hover {
            background: #E6D600;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           TOAST NOTIFICATIONS
        ═══════════════════════════════════════════════════════════════ */
        
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: var(--space-md) var(--space-lg);
            background: var(--gray-90);
            color: var(--white);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 200;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .toast.success {
            background: var(--traffic-green);
        }
        
        .toast.error {
            background: var(--traffic-red);
        }
        
        .toast-btn {
            padding: 8px 16px;
            background: var(--sartorius-yellow);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--black);
            font-family: inherit;
            font-size: var(--font-size-sm);
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            animation: toastBtnPulse 1.5s ease-in-out infinite;
        }
        
        .toast-btn svg {
            width: 16px;
            height: 16px;
        }
        
        @keyframes toastBtnPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 237, 0, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(255, 237, 0, 0); }
        }
        
        .toast-btn:hover {
            animation: none;
            transform: scale(1.05);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           RESPONSIVE
        ═══════════════════════════════════════════════════════════════ */
        
        @media (max-width: 480px) {
            body {
                padding-top: 52px; /* Header plus petit sur mobile */
                padding-bottom: 60px; /* Footer plus petit sur mobile */
            }
            
            .header {
                padding: 6px 10px;
                padding-bottom: 10px;
            }
            
            .header-logo {
                height: 44px;
            }
            
            .header-title {
                font-size: 1.125rem;
            }
            
            .header-date {
                font-size: 0.75rem;
            }
            
            .submit-container {
                padding: 6px 12px;
            }
            
            .bottom-bar {
                gap: 8px;
            }
            
            .score-display {
                padding: 6px 10px;
            }
            
            .score-display .score-value {
                font-size: 1rem;
            }
            
            .score-display .score-max {
                font-size: 0.75rem;
            }
            
            .score-display .score-percent {
                font-size: 0.7rem;
            }
            
            .submit-btn {
                padding: 10px 12px;
                font-size: 0.875rem;
            }
            
            .menu-btn {
                width: 40px;
                height: 40px;
            }
            
            .container {
                padding: var(--space-md);
            }
            
            .s-header {
                padding: var(--space-md);
            }
            
            .s-badge {
                width: 36px;
                height: 36px;
                font-size: var(--font-size-base);
            }
            
            .score-btn {
                min-height: 52px;
            }
            
            .score-btn .score-label {
                display: none;
            }
        }
        
        /* ═══════════════════════════════════════════════════════════════
           FOOTER
        ═══════════════════════════════════════════════════════════════ */
        
        .footer {
            text-align: center;
            padding: 5px var(--space-md);
            margin-bottom: 70px;
            font-size: var(--font-size-xs);
            color: var(--gray-50);
            line-height: 1.5;
        }
        
        #draft-indicator {
            display: block;
            font-size: var(--font-size-xs);
            color: var(--gray-40);
            margin-bottom: 4px;
            font-style: italic;
        }
        
        #draft-indicator:empty {
            display: none;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           MENU HAMBURGER
        ═══════════════════════════════════════════════════════════════ */
        
        .menu-btn {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            width: 44px;
            height: 44px;
            background: var(--gray-5);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background-color 0.15s ease;
            flex-shrink: 0;
        }
        
        .menu-btn:hover {
            background: var(--gray-10);
        }
        
        .menu-btn span {
            display: block;
            width: 18px;
            height: 2px;
            background: var(--gray-70);
            border-radius: 1px;
            transition: all 0.2s ease;
        }
        
        .menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(4px, 4px);
        }
        
        .menu-btn.active span:nth-child(2) {
            opacity: 0;
        }
        
        .menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(4px, -4px);
        }
        
        .menu-popup {
            position: absolute;
            bottom: calc(100% + 8px);
            right: 0;
            min-width: 220px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.2s ease;
            overflow: hidden;
        }
        
        .menu-popup.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .menu-section {
            padding: var(--space-xs) 0;
            border-bottom: 1px solid var(--gray-10);
        }
        
        .menu-section:last-child {
            border-bottom: none;
        }
        
        .menu-section-title {
            padding: var(--space-xs) var(--space-md);
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--gray-50);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            font-family: inherit;
            font-size: var(--font-size-sm);
            color: var(--black);
            background: none;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: background-color 0.15s ease;
        }
        
        .menu-item:hover {
            background: var(--gray-5);
        }
        
        .menu-item svg {
            width: 18px;
            height: 18px;
            color: var(--gray-60);
            flex-shrink: 0;
            transition: transform 0.3s ease, color 0.15s ease;
        }
        
        .menu-item:hover svg {
            color: var(--black);
        }
        
        .menu-item.danger {
            color: var(--traffic-red);
        }
        
        .menu-item.danger svg {
            color: var(--traffic-red);
        }
        
        /* Animations des icônes du menu */
        .menu-item:hover .icon-save .save-arrow {
            animation: saveArrow 0.5s ease;
        }
        @keyframes saveArrow {
            0% { transform: translateY(-4px); opacity: 0; }
            50% { transform: translateY(1px); }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .menu-item:hover .icon-load .load-arrow {
            animation: loadArrow 0.5s ease;
        }
        @keyframes loadArrow {
            0% { transform: translateY(4px); opacity: 0; }
            50% { transform: translateY(-1px); }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .menu-item:hover .icon-import .import-arrow {
            animation: loadArrow 0.5s ease;
        }
        
        .menu-item:hover .icon-reset {
            animation: resetSpin 0.6s ease-in-out;
        }
        @keyframes resetSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-360deg); }
        }
        
        .menu-item:hover .icon-sharepoint {
            animation: sharepointFly 0.5s ease;
        }
        @keyframes sharepointFly {
            0% { transform: translate(0, 0); }
            50% { transform: translate(3px, -3px); }
            100% { transform: translate(0, 0); }
        }
        
        .menu-item:hover .icon-clock .clock-hands {
            animation: clockSpin 0.6s ease-in-out;
            transform-origin: 12px 12px;
        }
        @keyframes clockSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-360deg); }
        }
        
        .menu-item:hover .icon-user-plus .user-body {
            animation: warningPulse 0.5s ease;
            transform-origin: center center;
        }
        @keyframes warningPulse {
            0% { transform: scale(1); }
            25% { transform: scale(1.15); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .menu-item:hover .icon-book .book-cover {
            animation: bookOpen 0.5s ease;
            transform-origin: left center;
        }
        @keyframes bookOpen {
            0% { transform: perspective(100px) rotateY(0deg); }
            50% { transform: perspective(100px) rotateY(-30deg); }
            100% { transform: perspective(100px) rotateY(0deg); }
        }
        
        .menu-item:hover .icon-moon {
            animation: moonPulse 0.5s ease;
        }
        @keyframes moonPulse {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(-20deg) scale(1.2); }
            100% { transform: rotate(0deg) scale(1); }
        }
        
        .menu-item:hover .icon-sharepoint {
            animation: sharepointArrow 0.5s ease;
        }
        @keyframes sharepointArrow {
            0% { transform: translate(0, 0); }
            50% { transform: translate(3px, -3px); }
            100% { transform: translate(0, 0); }
        }
        
        .menu-item:hover .icon-sun .sun-rays {
            animation: sunRays 0.6s ease;
            transform-origin: 12px 12px;
        }
        @keyframes sunRays {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(45deg); }
        }
        
        .menu-item:hover .icon-help .help-dot {
            animation: helpDot 0.4s ease;
        }
        @keyframes helpDot {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-2px) scale(1.3); }
        }
        
        .menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 98;
        }
        
        .menu-overlay.visible {
            display: block;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           MODALE DE CONFIRMATION
        ═══════════════════════════════════════════════════════════════ */
        
        .confirm-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 300;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
        }
        
        .confirm-modal-overlay.visible {
            display: flex;
        }
        
        .confirm-modal {
            background: var(--white);
            border-radius: var(--radius-lg);
            max-width: 320px;
            width: 100%;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .confirm-modal-body {
            padding: var(--space-lg);
            text-align: center;
        }
        
        .confirm-modal-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto var(--space-md);
        }
        
        .confirm-modal-icon.warning svg {
            color: var(--score-2);
        }
        
        .confirm-modal-icon.danger svg {
            color: var(--traffic-red);
        }
        
        .confirm-modal-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin-bottom: var(--space-sm);
            color: var(--black);
        }
        
        .confirm-modal-text {
            font-size: var(--font-size-sm);
            color: var(--gray-60);
            line-height: 1.5;
        }
        
        .confirm-modal-actions {
            display: flex;
            border-top: 1px solid var(--gray-10);
        }
        
        .confirm-modal-btn {
            flex: 1;
            padding: var(--space-md);
            font-family: inherit;
            font-size: var(--font-size-base);
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        
        .confirm-modal-btn.cancel {
            background: var(--gray-5);
            color: var(--gray-70);
        }
        
        .confirm-modal-btn.cancel:hover {
            background: var(--gray-10);
        }
        
        .confirm-modal-btn.confirm {
            background: var(--sartorius-yellow);
            color: var(--black);
        }
        
        .confirm-modal-btn.confirm:hover {
            background: var(--sartorius-yellow-hover);
        }
        
        .confirm-modal-btn.danger {
            background: var(--traffic-red);
            color: var(--white);
        }
        
        .confirm-modal-btn.danger:hover {
            background: #c9003d;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           POPUP EXPORT
        ═══════════════════════════════════════════════════════════════ */
        
        .export-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            padding: var(--space-md);
        }
        
        .export-modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .export-modal {
            background: var(--white);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 360px;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.2s ease;
        }
        
        .export-modal-overlay.visible .export-modal {
            transform: scale(1);
        }
        
        .export-modal-header {
            padding: var(--space-lg);
            padding-bottom: var(--space-sm);
            text-align: center;
        }
        
        .export-modal-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--black);
        }
        
        .export-modal-body {
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        .export-summary {
            text-align: center;
            padding: var(--space-md);
            background: var(--gray-5);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-sm);
            color: var(--gray-70);
        }
        
        .export-summary strong {
            display: block;
            font-size: var(--font-size-base);
            color: var(--black);
            margin-bottom: var(--space-xs);
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .export-option {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--white);
            border: 2px solid var(--gray-20);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: left;
            font-family: inherit;
        }
        
        .export-option:hover {
            border-color: var(--sartorius-yellow);
            background: var(--gray-5);
        }
        
        .export-option:active {
            transform: scale(0.98);
        }
        
        .export-option-icon {
            width: 44px;
            height: 44px;
            background: var(--sartorius-yellow);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .export-option-icon svg {
            width: 22px;
            height: 22px;
            stroke: var(--black);
        }
        
        .export-option-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .export-option-title {
            font-weight: 600;
            font-size: var(--font-size-base);
            color: var(--black);
        }
        
        .export-option-desc {
            font-size: var(--font-size-sm);
            color: var(--gray-60);
        }
        
        .export-modal-footer {
            padding: var(--space-md) var(--space-lg);
            border-top: 1px solid var(--gray-10);
            text-align: center;
        }
        
        .export-cancel-btn {
            padding: 12px 24px;
            background: var(--gray-5);
            border: none;
            border-radius: var(--radius-md);
            color: var(--black);
            font-family: inherit;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-cancel-btn svg {
            width: 18px;
            height: 18px;
        }
        
        .export-cancel-btn:hover {
            background: var(--gray-10);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           MODE SOMBRE
        ═══════════════════════════════════════════════════════════════ */
        
        body.dark-mode {
            --white: #1e1e1e;
            --black: #f5f5f5;
            --gray-5: #2a2a2a;
            --gray-10: #333333;
            --gray-20: #404040;
            --gray-30: #555555;
            --gray-40: #777777;
            --gray-50: #999999;
            --gray-60: #b0b0b0;
            --gray-70: #cccccc;
            --gray-80: #e0e0e0;
            --gray-90: #f0f0f0;
            background: #121212;
        }
        
        /* Header - garder le jaune Sartorius */
        body.dark-mode .header {
            background: var(--sartorius-yellow);
            color: #000000;
        }
        
        body.dark-mode .header-date {
            color: #555555;
        }
        
        /* Sections S - meilleur contraste */
        body.dark-mode .s-section {
            border-color: var(--gray-30);
        }
        
        body.dark-mode .s-header {
            border-color: var(--gray-30);
        }
        
        /* Badges S (1-5) - garder texte sombre sur fond jaune */
        body.dark-mode .s-badge {
            color: #000000;
        }
        
        /* Boutons de score - bordures plus visibles */
        body.dark-mode .score-btn {
            border-color: var(--gray-40);
            background: var(--gray-10);
        }
        
        body.dark-mode .score-btn .score-value {
            color: var(--gray-70);
        }
        
        body.dark-mode .score-btn .score-label {
            color: var(--gray-60);
        }
        
        /* Score 3 (jaune) sélectionné - garder texte sombre */
        body.dark-mode .score-btn[data-score="3"]:hover .score-value,
        body.dark-mode .score-btn[data-score="3"]:hover .score-label,
        body.dark-mode .score-btn[data-score="3"].selected .score-value,
        body.dark-mode .score-btn[data-score="3"].selected .score-label {
            color: #000000;
        }
        
        /* Score 2 (orange) - garder texte sombre */
        body.dark-mode .score-btn[data-score="2"]:hover .score-value,
        body.dark-mode .score-btn[data-score="2"]:hover .score-label,
        body.dark-mode .score-btn[data-score="2"].selected .score-value,
        body.dark-mode .score-btn[data-score="2"].selected .score-label {
            color: #000000;
        }
        
        /* Inputs et textareas */
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: var(--gray-10);
            border-color: var(--gray-40);
            color: var(--black);
        }
        
        body.dark-mode input::placeholder,
        body.dark-mode textarea::placeholder {
            color: var(--gray-50);
        }
        
        body.dark-mode select option {
            background: var(--gray-10);
            color: var(--black);
        }
        
        /* Pastilles info */
        body.dark-mode .info-badge {
            border-color: var(--gray-50);
            color: var(--gray-60);
        }
        
        /* Action badges - état normal */
        body.dark-mode .action-badge {
            background: var(--gray-30);
        }
        
        /* Action badges - needs-action (orange pulsant) */
        body.dark-mode .action-badge.needs-action {
            background: var(--score-2);
        }
        
        /* Action badges - suggest-elevation (orange fixe) */
        body.dark-mode .action-badge.suggest-elevation {
            background: var(--score-2);
        }
        
        /* Action badges - has-action (jaune avec check) */
        body.dark-mode .action-badge.has-action {
            background: var(--sartorius-yellow);
        }
        
        body.dark-mode .action-badge.has-action svg {
            color: #000000;
        }
        
        /* Menu popup */
        body.dark-mode .menu-popup {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .menu-section-title {
            color: var(--gray-60);
        }
        
        body.dark-mode .menu-item svg {
            color: var(--gray-60);
        }
        
        body.dark-mode .menu-item:hover svg {
            color: var(--black);
        }
        
        /* Modale de confirmation */
        body.dark-mode .confirm-modal {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .confirm-modal-icon svg {
            color: var(--gray-60);
        }
        
        /* Bouton confirm jaune - texte sombre */
        body.dark-mode .confirm-modal-btn.confirm {
            color: #000000;
        }
        
        /* Info popup */
        body.dark-mode .info-popup {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
        }
        
        /* Submit container / bottom bar */
        body.dark-mode .submit-container {
            border-top-color: var(--gray-30);
        }
        
        body.dark-mode .score-display {
            background: var(--gray-10);
        }
        
        /* Score percent jaune - texte sombre */
        body.dark-mode .score-percent.good {
            color: #000000;
        }
        
        /* Coches des scores 2 et 3 - forcer noir */
        body.dark-mode .score-btn[data-score="2"].selected::after,
        body.dark-mode .score-btn[data-score="3"].selected::after {
            color: #000000;
        }
        
        /* Zone action - fond et bordure adaptés */
        body.dark-mode .action-block {
            background: #3d3520;
            border-color: #665a2e;
        }
        
        body.dark-mode .action-type-toggle {
            border-color: var(--gray-40);
        }
        
        body.dark-mode .action-type-btn {
            background: var(--gray-10);
            color: var(--gray-60);
        }
        
        body.dark-mode .action-type-btn:first-child {
            border-right-color: var(--gray-40);
        }
        
        body.dark-mode .action-type-btn:hover {
            background: var(--gray-20);
        }
        
        body.dark-mode .action-type-btn.selected {
            background: var(--sartorius-yellow);
            color: #000000;
        }
        
        body.dark-mode .action-field input {
            background: var(--gray-10);
            border-color: var(--gray-40);
            color: var(--black);
        }
        
        body.dark-mode .action-field input::placeholder {
            color: var(--gray-50);
        }
        
        body.dark-mode .action-field input:focus {
            border-color: var(--sartorius-yellow);
        }
        
        /* Bouton submit désactivé */
        body.dark-mode .submit-btn:disabled {
            background: var(--gray-30);
            color: var(--gray-50);
        }
        
        /* Bouton submit ready (jaune) - texte sombre */
        body.dark-mode .submit-btn.ready {
            color: #000000;
        }
        
        /* Toast */
        body.dark-mode .toast {
            background: var(--gray-80);
            color: #000000;
        }
        
        /* Footer */
        body.dark-mode .footer {
            color: var(--gray-60);
        }
        
        body.dark-mode #draft-indicator {
            color: var(--gray-50);
        }
        
        /* Critères scorés */
        body.dark-mode .criteria-card.scored {
            background: var(--gray-10);
        }
        
        /* Progress bar */
        body.dark-mode .progress-bar {
            background: var(--gray-30);
        }

        /* ═══════════════════════════════════════════════════════════════
           ACCESSIBILITÉ
        ═══════════════════════════════════════════════════════════════ */
        
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                transition: none !important;
            }
        }
        
        .score-btn:focus-visible,
        .submit-btn:focus-visible,
        .optional-toggle:focus-visible {
            outline: 2px solid var(--black);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Header avec barre de progression intégrée -->
    <header class="header">
        <div class="header-content">
            <!-- Logo Sartorius -->
            <svg class="header-logo" viewBox="0 0 2204.72 850.39" fill="#20201E">
                <path d="M1569.06,460.27c0,57.84,36.17,112.4,107.04,112.4c69.22,0,106.34-54.56,106.34-112.4v-11.64h-40.72v11.64c0,43-20.43,75.48-65.62,75.48c-45.19,0-65.62-33.34-65.62-75.48V283.47h-41.42V460.27z"/>
                <rect x="1478.3" y="283.47" width="41.42" height="283.46"/>
                <path d="M973.25,427.46c0,80.81,63.75,144.4,144.07,144.4c80.33,0,144-63.59,144-144.4c0-80.4-63.68-143.99-144-143.99h-6.7v36.1h6.7c58.99,0,105.51,47.18,105.51,107.89c0,61.12-46.52,108.3-105.51,108.3c-58.99,0-105.58-47.18-105.58-108.3H973.25z"/>
                <path d="M1740.34,351.18c0,34.87,16.27,54.72,42.26,68.69c20.12,10.68,41.21,13.15,60.91,20.55c28.8,10.65,37.54,25.34,37.54,46.14c0,28.49-19.58,46.68-51.87,46.68h-4.07v33.7h2.45c57.33,0,93.69-35.8,93.69-80.55c0-29.37-14.25-59.06-51.97-75.91c-20.12-9.04-44.29-13.62-61.89-21.02c-19.28-8.22-26.33-19.38-26.33-37.87c0-22.19,18.44-39.04,46.52-39.04c36.88,0,54.07,18.08,54.91,44.39h37.3c1.26-41.1-28.5-79.32-92.21-79.32C1775.2,277.62,1740.34,310.08,1740.34,351.18"/>
                <path d="M1263.53,320.8h82.77c26.78,0,52.71,20.92,52.71,52.1c0,29.95-23.85,52.51-53.97,52.51h-43.67v37.33l32.9-0.32l55.03,104.52h45.6l-59.43-109.35c31.08-9.44,62.1-41.61,62.1-84.69c0-51.28-36.82-89.43-89.95-89.43h-84.1V320.8z"/>
                <polygon points="852.34,320.8 902.61,320.8 902.61,566.93 943.61,566.93 943.61,320.8 1061.65,320.8 1061.65,283.47 852.34,283.47"/>
                <polygon points="451.71,566.93 491.88,566.93 581.41,332.28 673.87,566.93 716.96,566.93 602.75,283.47 560.07,283.47"/>
                <path d="M292.56,351.07c0,32.83,13.39,54.99,41.01,68.94c20.09,10.26,41.85,13.13,61.51,20.52c20.92,7.8,28.87,14.36,31.8,25.85h42.26c-5.86-24.21-22.18-43.91-47.28-55.4c-20.09-9.03-45.61-13.95-63.19-21.34c-19.25-8.21-25.11-19.7-25.11-38.17c0-22.16,18.41-38.98,46.45-38.98c36.82,0,53.98,18.06,54.82,44.32h37.24c1.25-41.04-28.46-79.2-92.06-79.2C327.71,277.62,292.56,310.03,292.56,351.07 M283.5,478.7c-1.26,45.96,29.57,88.23,99.45,88.23h2.51v-34.47h-2.51c-37.24,0-60.53-23.8-60.53-53.76v-15.15H283.5V478.7z"/>
                <path d="M666.04,320.8h84.33c26.77,0,52.71,20.92,52.71,52.1c0,29.95-23.85,52.51-53.97,52.51h-45.23v37.33l34.46-0.32l55.03,104.52h45.6l-59.43-109.35c31.08-9.44,62.1-41.61,62.1-84.69c0-51.28-36.82-89.43-89.95-89.43h-85.67V320.8z"/>
            </svg>
            <div class="header-right">
                <div class="header-title">Audit 5S</div>
                <div class="header-date" id="header-date"></div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </header>
    
    <!-- Contenu principal -->
    <main class="container">
        <!-- Informations générales -->
        <section class="info-section">
            <div class="form-row">
                <div class="form-group">
                    <label for="auditeur">Auditeur</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="auditeur" placeholder="Nom" required autocomplete="off">
                        <div class="autocomplete-suggestions" id="auditeur-suggestions"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="zone">Zone</label>
                    <select id="zone" required>
                        <option value="" disabled selected>Sélectionner</option>
                        <optgroup label="Production">
                            <option value="Assemblage">Assemblage</option>
                            <option value="Process / Entrée">Process / Entrée</option>
                            <option value="Outillage">Outillage</option>
                            <option value="Extérieurs">Extérieurs</option>
                        </optgroup>
                        <optgroup label="Logistique (bientôt disponible)" disabled>
                        </optgroup>
                        <optgroup label="Administratif (bientôt disponible)" disabled>
                        </optgroup>
                        <optgroup label="Product Development (bientôt disponible)" disabled>
                        </optgroup>
                    </select>
                </div>
            </div>
            
            <!-- Niveau d'audit - Slider -->
            <div class="level-slider-container">
                <label class="form-label">Niveau</label>
                <div class="level-slider">
                    <input type="range" id="level-input" min="1" max="3" value="1" step="1">
                    <div class="level-labels">
                        <span data-level="1">1</span>
                        <span data-level="2">2</span>
                        <span data-level="3">3</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 1S - TRIER -->
        <section class="s-section" data-section="seiri">
            <div class="s-header">
                <div class="s-badge">1</div>
                <div class="s-title-group">
                    <div class="s-title">Trier<button type="button" class="info-badge" data-info="seiri">i</button></div>
                    <div class="s-subtitle">Supprimer l'inutile, garder le nécessaire</div>
                </div>
                <div class="s-score" data-section-score="seiri">0/12</div>
                <svg class="s-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div class="s-body">
                <div class="criteria-card" data-criteria="seiri_1">
                    <div class="criteria-header">
                        <div class="criteria-label">Obsolètes identifiés et éliminés<button type="button" class="info-badge" data-info="seiri_1">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiri_2">
                    <div class="criteria-header">
                        <div class="criteria-label">Objets inutiles retirés de la zone<button type="button" class="info-badge" data-info="seiri_2">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiri_3">
                    <div class="criteria-header">
                        <div class="criteria-label">Affichages obsolètes retirés<button type="button" class="info-badge" data-info="seiri_3">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2S - RANGER -->
        <section class="s-section" data-section="seiton">
            <div class="s-header">
                <div class="s-badge">2</div>
                <div class="s-title-group">
                    <div class="s-title">Ranger<button type="button" class="info-badge" data-info="seiton">i</button></div>
                    <div class="s-subtitle">Une place pour chaque chose</div>
                </div>
                <div class="s-score" data-section-score="seiton">0/12</div>
                <svg class="s-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div class="s-body">
                <div class="criteria-card" data-criteria="seiton_1">
                    <div class="criteria-header">
                        <div class="criteria-label">Chaque chose a un emplacement identifié<button type="button" class="info-badge" data-info="seiton_1">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiton_2">
                    <div class="criteria-header">
                        <div class="criteria-label">Tout est rangé à sa place<button type="button" class="info-badge" data-info="seiton_2">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiton_3">
                    <div class="criteria-header">
                        <div class="criteria-label">Rangement par fréquence d'utilisation<button type="button" class="info-badge" data-info="seiton_3">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3S - NETTOYER -->
        <section class="s-section" data-section="seiso">
            <div class="s-header">
                <div class="s-badge">3</div>
                <div class="s-title-group">
                    <div class="s-title">Nettoyer<button type="button" class="info-badge" data-info="seiso">i</button></div>
                    <div class="s-subtitle">Maintenir propre et inspecter</div>
                </div>
                <div class="s-score" data-section-score="seiso">0/12</div>
                <svg class="s-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div class="s-body">
                <div class="criteria-card" data-criteria="seiso_1">
                    <div class="criteria-header">
                        <div class="criteria-label">Sols, murs et vitres propres<button type="button" class="info-badge" data-info="seiso_1">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiso_2">
                    <div class="criteria-header">
                        <div class="criteria-label">Équipements et installations propres<button type="button" class="info-badge" data-info="seiso_2">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiso_3">
                    <div class="criteria-header">
                        <div class="criteria-label">Matériel de nettoyage disponible et rangé<button type="button" class="info-badge" data-info="seiso_3">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4S - STANDARDISER -->
        <section class="s-section" data-section="seiketsu">
            <div class="s-header">
                <div class="s-badge">4</div>
                <div class="s-title-group">
                    <div class="s-title">Standardiser<button type="button" class="info-badge" data-info="seiketsu">i</button></div>
                    <div class="s-subtitle">Définir les règles et les appliquer</div>
                </div>
                <div class="s-score" data-section-score="seiketsu">0/12</div>
                <svg class="s-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div class="s-body">
                <div class="criteria-card" data-criteria="seiketsu_1">
                    <div class="criteria-header">
                        <div class="criteria-label">Standards et consignes de sécurité affichés<button type="button" class="info-badge" data-info="seiketsu_1">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiketsu_2">
                    <div class="criteria-header">
                        <div class="criteria-label">Zone polyvalente et adaptable<button type="button" class="info-badge" data-info="seiketsu_2">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="seiketsu_3">
                    <div class="criteria-header">
                        <div class="criteria-label">Environnement sûr, EPI disponibles<button type="button" class="info-badge" data-info="seiketsu_3">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5S - PÉRENNISER -->
        <section class="s-section" data-section="shitsuke">
            <div class="s-header">
                <div class="s-badge">5</div>
                <div class="s-title-group">
                    <div class="s-title">Pérenniser<button type="button" class="info-badge" data-info="shitsuke">i</button></div>
                    <div class="s-subtitle">Ancrer les bonnes pratiques</div>
                </div>
                <div class="s-score" data-section-score="shitsuke">0/12</div>
                <svg class="s-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div class="s-body">
                <div class="criteria-card" data-criteria="shitsuke_1">
                    <div class="criteria-header">
                        <div class="criteria-label">Standards Sartorius respectés<button type="button" class="info-badge" data-info="shitsuke_1">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="shitsuke_2">
                    <div class="criteria-header">
                        <div class="criteria-label">Écarts précédents traités<button type="button" class="info-badge" data-info="shitsuke_2">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-card" data-criteria="shitsuke_3">
                    <div class="criteria-header">
                        <div class="criteria-label">Planning 5S respecté<button type="button" class="info-badge" data-info="shitsuke_3">i</button></div>
                        <span class="action-badge-label">Action</span>
                        <button type="button" class="action-badge" title="Ajouter une action">
                            <svg class="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <svg class="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="score-buttons">
                        <button type="button" class="score-btn" data-score="0">
                            <span class="score-value">0</span>
                            <span class="score-label">Inexistant</span>
                        </button>
                        <button type="button" class="score-btn" data-score="1">
                            <span class="score-value">1</span>
                            <span class="score-label">Non conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="2">
                            <span class="score-value">2</span>
                            <span class="score-label">À améliorer</span>
                        </button>
                        <button type="button" class="score-btn" data-score="3">
                            <span class="score-value">3</span>
                            <span class="score-label">Conforme</span>
                        </button>
                        <button type="button" class="score-btn" data-score="4">
                            <span class="score-value">4</span>
                            <span class="score-label">Excellent</span>
                        </button>
                    </div>
                    <div class="action-block">
                        <div class="action-type-toggle">
                            <button type="button" class="action-type-btn selected" data-type="ecart">Écart</button>
                            <button type="button" class="action-type-btn" data-type="elevation">Élévation</button>
                        </div>
                        <div class="action-row">
                            <div class="action-field">
                                <input type="text" class="action-text" placeholder="Action">
                            </div>
                            <div class="action-field">
                                <div class="autocomplete-wrapper"><input type="text" class="action-responsable" placeholder="Responsable" autocomplete="off"><div class="autocomplete-suggestions responsable-suggestions"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>        
        <!-- Commentaire global optionnel -->
        <section class="info-section">
            <div class="optional-section">
                <div class="optional-toggle" onclick="toggleOptional(this)" role="button" tabindex="0">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>Ajouter un commentaire</span>
                </div>
                <div class="optional-content" id="optional-global">
                    <textarea id="comment-global" placeholder="Commentaire général (optionnel)"></textarea>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="footer">
            <span id="draft-indicator"></span>
            Continuous Improvement • Audit 5S<br>
            Sartorius Chromatography Equipment • Pompey
        </footer>
    </main>
    
    <!-- Bandeau fixe bas : score + bouton + menu -->
    <div class="submit-container">
        <div class="bottom-bar">
            <div class="score-display">
                <span class="score-value" id="score-total">0</span>
                <span class="score-max">/ 60</span>
                <span class="score-percent" id="score-percent">0%</span>
            </div>
            <button type="button" class="submit-btn" id="submit-btn" disabled>
                <span id="submit-text">Compléter l'audit</span>
            </button>
            <div style="position: relative;">
                <button type="button" class="menu-btn" id="menu-btn" aria-label="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="menu-popup" id="menu-popup">
                    <div class="menu-section">
                        <div class="menu-section-title">Audit en cours</div>
                        <button type="button" class="menu-item" onclick="menuAction('save')">
                            <svg class="icon-save" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <g class="save-arrow">
                                    <polyline points="12 11 12 17"></polyline>
                                    <polyline points="9 14 12 17 15 14"></polyline>
                                </g>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            </svg>
                            Reprendre plus tard
                        </button>
                        <button type="button" class="menu-item" onclick="menuAction('load')">
                            <svg class="icon-load" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"></path>
                                <g class="load-arrow">
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </g>
                            </svg>
                            Charger un brouillon
                        </button>
                        <button type="button" class="menu-item danger" onclick="menuAction('reset')">
                            <svg class="icon-reset" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="1 4 1 10 7 10"></polyline>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                            </svg>
                            Réinitialiser l'audit
                        </button>
                        <button type="button" class="menu-item" onclick="menuAction('sharepoint')">
                            <svg class="icon-sharepoint" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                            Ouvrir SharePoint 5S
                        </button>
                    </div>

                    <div class="menu-section">
                        <div class="menu-section-title">Paramètres</div>
                        <button type="button" class="menu-item" id="darkmode-btn" onclick="menuAction('darkmode')">
                            <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                                <circle cx="12" cy="12" r="5"></circle>
                                <g class="sun-rays">
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </g>
                            </svg>
                            <span class="darkmode-label">Thème sombre</span>
                        </button>
                    </div>
                    <div class="menu-section">
                        <div class="menu-section-title">Aide</div>
                        <button type="button" class="menu-item" onclick="menuAction('guide')">
                            <svg class="icon-book" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path class="book-cover" d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            </svg>
                            Guide des critères 5S
                        </button>
                        <button type="button" class="menu-item" onclick="menuAction('report')">
                            <svg class="icon-user-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <g class="user-body">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </g>
                            </svg>
                            Signaler un problème
                        </button>
                        <button type="button" class="menu-item" onclick="menuAction('about')">
                            <svg class="icon-help" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <circle class="help-dot" cx="12" cy="17" r="0.5" fill="currentColor"></circle>
                            </svg>
                            Aide / À propos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="menu-overlay" id="menu-overlay"></div>
    
    <!-- Modale de confirmation -->
    <div class="confirm-modal-overlay" id="confirm-modal">
        <div class="confirm-modal">
            <div class="confirm-modal-body">
                <div class="confirm-modal-icon" id="confirm-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                </div>
                <div class="confirm-modal-title" id="confirm-title">Confirmation</div>
                <div class="confirm-modal-text" id="confirm-text">Êtes-vous sûr ?</div>
            </div>
            <div class="confirm-modal-actions">
                <button type="button" class="confirm-modal-btn cancel" onclick="closeConfirmModal()">Annuler</button>
                <button type="button" class="confirm-modal-btn confirm" id="confirm-btn">Confirmer</button>
            </div>
        </div>
    </div>
    
    <!-- Popup Info -->
    <div class="info-popup-overlay" id="info-popup">
        <div class="info-popup">
            <div class="info-popup-header">
                <span class="info-popup-title" id="info-popup-title"></span>
                <button type="button" class="info-popup-close" id="info-popup-close">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="info-popup-body" id="info-popup-body"></div>
        </div>
    </div>
    
    <!-- Popup Export -->
    <div class="export-modal-overlay" id="export-modal">
        <div class="export-modal">
            <div class="export-modal-header">
                <span class="export-modal-title">Exporter l'audit</span>
            </div>
            <div class="export-modal-body">
                <div class="export-summary" id="export-summary"></div>
                <div class="export-options">
                    <button type="button" class="export-option" id="export-sharepoint">
                        <div class="export-option-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </div>
                        <div class="export-option-text">
                            <span class="export-option-title">Télécharger + SharePoint</span>
                            <span class="export-option-desc">Télécharge le JSON et ouvre le dossier</span>
                        </div>
                    </button>
                    <button type="button" class="export-option" id="export-mail">
                        <div class="export-option-icon icon-mail">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </div>
                        <div class="export-option-text">
                            <span class="export-option-title">Envoyer par mail</span>
                            <span class="export-option-desc">Ouvre votre messagerie avec les données</span>
                        </div>
                    </button>
                </div>
            </div>
            <div class="export-modal-footer">
                <button type="button" class="export-cancel-btn" id="export-cancel">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    Retour
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast notification -->
    <div class="toast" id="toast"></div>
    
    <script>
        // ═══════════════════════════════════════════════════════════════
        // ÉTAT DE L'APPLICATION
        // ═══════════════════════════════════════════════════════════════
        
        const auditData = {
            level: null,
            scores: {},
            actions: {}
        };
        
        const TOTAL_CRITERIA = 15;
        const MAX_SCORE = 60;
        
        // Liste des auditeurs
        const AUDITEURS = [
            "Ancori Gaelle", "Aubrion Xavier", "Aulenbacher Marc", "Azem Idir", "Aziz Abdelhadi",
            "Badoual Loïc", "Barthes Laurent", "Beulay Jean Luc", "Bilde Hugues", "Blot Philippe",
            "Bontems Julian", "Bouchand Jean François", "Bourdon Michael", "Burkel Ludovic",
            "Cardaire Louis", "Cerqueira Pascal", "Chauvot De Beauchene Lubin", "Chevalier Jerome",
            "Claude Aurelien", "Courrier Aurélie", "De Miscault Pierre", "Delavault Guillaume",
            "Demeester Alexia", "Denis Verbeyst Delphine", "Dupont Olivier", "Egrot Christophe",
            "Etienne Germain", "Fablet Primael", "Friedrich-Lang Caty", "Geny Jean-Philippe",
            "Goldstein David", "Goueffon Estelle", "Goy Lucile", "Guyot Joel", "Habert Loïc",
            "Hacquin Thibaut", "Heintz Martine", "Hermann Adrien", "Humbertclaude Laurent",
            "Jeanbille Tommy", "Jeanroy Cyrille", "Jouhari Yassine", "Laurent Marc", "Laziz Samia",
            "Ledore Lyonel", "Leidner Adeline", "Maarouf Mohamed", "Machado Cezar", "Mainguy Mickael",
            "Marandel Vianney", "Marchal Julien", "Marin Fabienne", "Marques Manuel", "Mathieu Anne",
            "Mathieu Pierre", "Menolfi Jonathan", "Mersel Laura", "Morey Sauffroy Celine",
            "Mourolin Mathieu", "Muller Eric", "Oudin Alexis", "Parenty Olivier", "Parisse Aurelien",
            "Peultier Hugo", "Raffo Adrien", "Raoult Stephane", "Rimlinger Claire", "Rosienski Laurent",
            "Ruse Romuald", "Simao José", "Sosnowski Corinne", "Spindler Stéphane", "Strauss Dorian",
            "Suleyman Anna", "Thirion Alexandre", "Thomasset Guy", "Vautelin Sebastien",
            "Viratelle Frédéric", "Vuillemin Yannick", "Weber Michael"
        ];
        

        // ═══════════════════════════════════════════════════════════════
        // INITIALISATION
        // ═══════════════════════════════════════════════════════════════
        
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const options = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
            document.getElementById('header-date').textContent = today.toLocaleDateString('fr-FR', options);
            
            initLevelSlider();
            initCollapsibleSections();
            initScoreButtons();
            initAutocomplete();
            initExportModal();
            
            document.getElementById('zone').addEventListener('change', updateFormState);
            document.getElementById('auditeur').addEventListener('input', updateFormState);
            document.getElementById('submit-btn').addEventListener('click', submitAudit);
            
            initInfoPopup();
            
            updateFormState();
        });
        
        // ═══════════════════════════════════════════════════════════════
        // SECTIONS COLLAPSIBLES
        // ═══════════════════════════════════════════════════════════════
        
        const sectionOrder = ['seiri', 'seiton', 'seiso', 'seiketsu', 'shitsuke'];
        
        function initCollapsibleSections() {
            const sections = document.querySelectorAll('.s-section');
            sections.forEach((section, index) => {
                if (index > 0) {
                    section.classList.add('collapsed');
                }
                const header = section.querySelector('.s-header');
                header.addEventListener('click', () => {
                    section.classList.toggle('collapsed');
                });
            });
        }
        
        function isSectionComplete(sectionName) {
            const sectionScores = Object.keys(auditData.scores).filter(key => key.startsWith(sectionName));
            return sectionScores.length === 3;
        }
        
        function autoExpandNextSection() {
            // Trouver quelle section on vient de scorer
            const lastScoredCriteria = Object.keys(auditData.scores).pop();
            if (!lastScoredCriteria) return;
            
            const currentSectionName = lastScoredCriteria.split('_')[0];
            const currentSectionIndex = sectionOrder.indexOf(currentSectionName);
            
            // Si on vient de compléter le 3e critère d'une section (pas la dernière)
            // → juste ouvrir la section suivante
            if (currentSectionIndex < sectionOrder.length - 1) {
                const criteriaInCurrentSection = Object.keys(auditData.scores).filter(k => k.startsWith(currentSectionName));
                
                if (criteriaInCurrentSection.length === 3) {
                    const nextSection = sectionOrder[currentSectionIndex + 1];
                    const nextEl = document.querySelector(`[data-section="${nextSection}"]`);
                    if (nextEl && nextEl.classList.contains('collapsed')) {
                        nextEl.classList.remove('collapsed');
                    }
                }
            }
        }
        
        // ═══════════════════════════════════════════════════════════════
        // GESTION DU NIVEAU D'AUDIT (SLIDER)
        // ═══════════════════════════════════════════════════════════════
        
        function initLevelSlider() {
            const slider = document.getElementById('level-input');
            auditData.level = 1;
            updateLevelLabels(1);
            
            slider.addEventListener('input', function() {
                const level = parseInt(this.value);
                auditData.level = level;
                updateLevelLabels(level);
                updateFormState();
            });
        }
        
        function updateLevelLabels(activeLevel) {
            document.querySelectorAll('.level-labels span').forEach(label => {
                if (parseInt(label.dataset.level) === activeLevel) {
                    label.classList.add('active');
                } else {
                    label.classList.remove('active');
                }
            });
        }
        
        // ═══════════════════════════════════════════════════════════════
        // AUTOCOMPLETE AUDITEUR & RESPONSABLES
        // ═══════════════════════════════════════════════════════════════
        
        function initAutocomplete() {
            // Autocomplete pour l'auditeur principal
            setupAutocomplete(
                document.getElementById('auditeur'),
                document.getElementById('auditeur-suggestions'),
                true // isAuditeur - pour sauvegarder en localStorage
            );
            
            // Autocomplete pour tous les champs responsable
            document.querySelectorAll('.action-responsable').forEach(input => {
                const suggestions = input.nextElementSibling;
                if (suggestions && suggestions.classList.contains('responsable-suggestions')) {
                    setupAutocomplete(input, suggestions, false);
                }
            });
            
            // Charger le dernier auditeur
            loadLastAuditeur();
        }
        
        function setupAutocomplete(input, suggestions, isAuditeur) {
            let activeIndex = -1;
            let isSelecting = false; // Flag pour éviter la validation pendant la sélection
            
            input.addEventListener('input', function() {
                const query = this.value.trim().toLowerCase();
                activeIndex = -1;
                
                if (query.length < 2) {
                    suggestions.classList.remove('visible');
                    return;
                }
                
                // Rechercher les correspondances (nom ou prénom)
                const matches = AUDITEURS.filter(name => {
                    const parts = name.toLowerCase().split(' ');
                    return parts.some(part => part.startsWith(query)) || 
                           name.toLowerCase().includes(query);
                }).slice(0, 5);
                
                if (matches.length === 0) {
                    suggestions.classList.remove('visible');
                    return;
                }
                
                // Afficher les suggestions
                suggestions.innerHTML = matches.map((name, index) => {
                    const highlighted = highlightMatch(name, query);
                    return `<div class="autocomplete-item" data-index="${index}" data-name="${name}">${highlighted}</div>`;
                }).join('');
                
                suggestions.classList.add('visible');
                activeIndex = 0; // Présélectionner le premier
                updateActiveItem(suggestions.querySelectorAll('.autocomplete-item'));
                
                // Ajouter les événements sur les items
                suggestions.querySelectorAll('.autocomplete-item').forEach(item => {
                    item.addEventListener('mousedown', function(e) {
                        e.preventDefault(); // Empêcher le blur
                        isSelecting = true;
                        selectItem(input, suggestions, this.dataset.name, isAuditeur);
                        isSelecting = false;
                    });
                });
            });
            
            // Navigation clavier
            input.addEventListener('keydown', function(e) {
                const items = suggestions.querySelectorAll('.autocomplete-item');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (!suggestions.classList.contains('visible') && this.value.length >= 2) {
                        // Réouvrir les suggestions
                        this.dispatchEvent(new Event('input'));
                    } else if (items.length > 0) {
                        activeIndex = Math.min(activeIndex + 1, items.length - 1);
                        updateActiveItem(items);
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (items.length > 0) {
                        activeIndex = Math.max(activeIndex - 1, 0);
                        updateActiveItem(items);
                    }
                } else if ((e.key === 'Enter' || e.key === 'Tab') && suggestions.classList.contains('visible') && activeIndex >= 0 && items.length > 0) {
                    e.preventDefault();
                    isSelecting = true;
                    selectItem(input, suggestions, items[activeIndex].dataset.name, isAuditeur);
                    isSelecting = false;
                    // Si Tab, passer au champ suivant
                    if (e.key === 'Tab') {
                        const nextInput = getNextInput(input);
                        if (nextInput) nextInput.focus();
                    }
                } else if (e.key === 'Escape') {
                    suggestions.classList.remove('visible');
                }
            });
            
            // Validation à la perte de focus (auditeur et responsables)
            input.addEventListener('blur', function() {
                // Délai pour laisser le mousedown se terminer
                setTimeout(() => {
                    if (!isSelecting) {
                        suggestions.classList.remove('visible');
                        validateNameField(this, isAuditeur);
                    }
                }, 150);
            });
            
            function updateActiveItem(items) {
                items.forEach((item, index) => {
                    item.classList.toggle('active', index === activeIndex);
                    if (index === activeIndex) {
                        item.scrollIntoView({ block: 'nearest' });
                    }
                });
            }
        }
        
        function selectItem(input, suggestions, name, isAuditeur) {
            input.value = name;
            suggestions.classList.remove('visible');
            if (isAuditeur) {
                saveLastAuditeur(name);
                updateFormState();
            } else {
                // Mettre à jour les données d'action directement sans déclencher l'autocomplete
                const card = input.closest('.criteria-card');
                if (card) {
                    const criteriaId = card.dataset.criteria;
                    const block = card.querySelector('.action-block');
                    const actionField = block.querySelector('.action-text');
                    
                    if (!auditData.actions[criteriaId]) {
                        const selectedType = block.querySelector('.action-type-btn.selected');
                        auditData.actions[criteriaId] = { 
                            type: selectedType ? selectedType.dataset.type : 'ecart'
                        };
                    }
                    auditData.actions[criteriaId].responsable = name;
                    auditData.actions[criteriaId].action = actionField ? actionField.value : '';
                    
                    // Mettre à jour la pastille
                    updateActionBadge(card, criteriaId);
                }
            }
        }
        
        function validateNameField(input, isAuditeur) {
            const value = input.value.trim();
            if (value && !AUDITEURS.includes(value)) {
                // Nom non valide - vider le champ et notifier
                input.value = '';
                showToast('Nom non reconnu — choisissez dans la liste', 'error');
                if (isAuditeur) {
                    const group = input.closest('.form-group');
                    if (group) highlightMissingField(group);
                }
            }
        }
        
        function getNextInput(currentInput) {
            const inputs = Array.from(document.querySelectorAll('input:not([type="hidden"]):not([type="file"]):not([type="range"]), select'));
            const currentIndex = inputs.indexOf(currentInput);
            return inputs[currentIndex + 1] || null;
        }
        
        // Fermer toutes les suggestions si clic en dehors
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-wrapper')) {
                document.querySelectorAll('.autocomplete-suggestions').forEach(s => {
                    s.classList.remove('visible');
                });
            }
        });
        
        function highlightMatch(name, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return name.replace(regex, '<mark>$1</mark>');
        }
        
        function saveLastAuditeur(name) {
            localStorage.setItem('audit5s_last_auditeur', name);
        }
        
        function loadLastAuditeur() {
            const lastAuditeur = localStorage.getItem('audit5s_last_auditeur');
            if (lastAuditeur && AUDITEURS.includes(lastAuditeur)) {
                document.getElementById('auditeur').value = lastAuditeur;
                updateFormState();
            }
        }
        
        // ═══════════════════════════════════════════════════════════════
        // GESTION DES SCORES ET ACTIONS
        // ═══════════════════════════════════════════════════════════════
        
        function initScoreButtons() {
            document.querySelectorAll('.score-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.criteria-card');
                    const criteriaId = card.dataset.criteria;
                    const score = parseInt(this.dataset.score);
                    
                    // Vérifier si auditeur et zone sont remplis
                    checkMissingFields();
                    
                    // Vérifier les actions incomplètes (action sans responsable valide)
                    checkIncompleteActions();
                    
                    // Réduire les autres blocs action ouverts
                    collapseOtherActions(card);
                    
                    card.querySelectorAll('.score-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    card.classList.add('scored');
                    auditData.scores[criteriaId] = score;
                    
                    // Gérer l'indicateur visuel selon le score
                    const actionBadge = card.querySelector('.action-badge');
                    if (actionBadge && !actionBadge.classList.contains('has-action')) {
                        actionBadge.classList.remove('needs-action', 'suggest-elevation');
                        
                        if (score <= 1) {
                            // Score 0-1 : pulse orange (écart)
                            actionBadge.classList.add('needs-action');
                        } else if (score === 2) {
                            // Score 2 : orange fixe (élévation)
                            actionBadge.classList.add('suggest-elevation');
                        }
                        // Score 3-4 : reste gris
                    }
                    
                    updateFormState();
                    autoExpandNextSection();
                });
            });
            
            document.querySelectorAll('.action-badge').forEach(badge => {
                badge.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const card = this.closest('.criteria-card');
                    const criteriaId = card.dataset.criteria;
                    const actionBlock = card.querySelector('.action-block');
                    
                    // Réduire les autres blocs action ouverts
                    collapseOtherActions(card);
                    
                    if (actionBlock) {
                        const isOpening = !actionBlock.classList.contains('visible');
                        actionBlock.classList.toggle('visible');
                        
                        // Si on ouvre et pas d'action existante, sélectionner le type par défaut
                        if (isOpening && !auditData.actions[criteriaId]) {
                            const defaultType = getDefaultActionType(criteriaId);
                            actionBlock.querySelectorAll('.action-type-btn').forEach(btn => {
                                btn.classList.toggle('selected', btn.dataset.type === defaultType);
                            });
                        }
                    }
                });
            });
            
            document.querySelectorAll('.action-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const toggle = this.closest('.action-type-toggle');
                    const card = this.closest('.criteria-card');
                    const criteriaId = card.dataset.criteria;
                    
                    toggle.querySelectorAll('.action-type-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Mettre à jour le type seulement si une action existe déjà
                    if (auditData.actions[criteriaId]) {
                        auditData.actions[criteriaId].type = this.dataset.type;
                        updateActionBadge(card, criteriaId);
                    }
                    // Sinon, on garde juste la sélection visuelle, l'action sera créée quand on tape
                });
            });
            
            document.querySelectorAll('.action-block').forEach(block => {
                const card = block.closest('.criteria-card');
                const criteriaId = card.dataset.criteria;
                const actionField = block.querySelector('.action-text');
                const responsableField = block.querySelector('.action-responsable');
                
                [actionField, responsableField].forEach(field => {
                    if (field) {
                        field.addEventListener('input', () => {
                            if (!auditData.actions[criteriaId]) {
                                // Récupérer le type sélectionné dans le bloc
                                const selectedType = block.querySelector('.action-type-btn.selected');
                                auditData.actions[criteriaId] = { 
                                    type: selectedType ? selectedType.dataset.type : getDefaultActionType(criteriaId)
                                };
                            }
                            auditData.actions[criteriaId].action = actionField.value.trim();
                            auditData.actions[criteriaId].responsable = responsableField.value.trim();
                            updateActionBadge(card, criteriaId);
                        });
                    }
                });
            });
        }
        
        function updateActionBadge(card, criteriaId) {
            const badge = card.querySelector('.action-badge');
            if (!badge) return;
            const action = auditData.actions[criteriaId];
            // Jaune + check si action ET responsable remplis
            const isComplete = action && action.action && action.responsable;
            badge.classList.toggle('has-action', isComplete);
            // Retirer les indicateurs si action complète
            if (isComplete) {
                badge.classList.remove('needs-action', 'suggest-elevation');
            }
        }
        
        function getDefaultActionType(criteriaId) {
            const score = auditData.scores[criteriaId];
            // Score 0-1 : Écart, Score 2 : Élévation
            return (score !== undefined && score <= 1) ? 'ecart' : 'elevation';
        }
        
        function collapseOtherActions(currentCard) {
            document.querySelectorAll('.action-block.visible').forEach(block => {
                const card = block.closest('.criteria-card');
                if (card !== currentCard) {
                    block.classList.remove('visible');
                }
            });
        }
        
        // ═══════════════════════════════════════════════════════════════
        // MISE À JOUR DE L'ÉTAT
        // ═══════════════════════════════════════════════════════════════
        
        function updateFormState() {
            const zone = document.getElementById('zone').value;
            const auditeur = document.getElementById('auditeur').value.trim();
            const scoredCount = Object.keys(auditData.scores).length;
            
            const totalScore = Object.values(auditData.scores).reduce((a, b) => a + b, 0);
            const percent = Math.round((totalScore / MAX_SCORE) * 100);
            
            document.getElementById('score-total').textContent = totalScore;
            
            const percentEl = document.getElementById('score-percent');
            percentEl.textContent = `${percent}%`;
            percentEl.className = 'score-percent';
            if (percent < 50) percentEl.classList.add('low');
            else if (percent < 70) percentEl.classList.add('medium');
            else if (percent < 85) percentEl.classList.add('good');
            else percentEl.classList.add('excellent');
            
            const sections = ['seiri', 'seiton', 'seiso', 'seiketsu', 'shitsuke'];
            sections.forEach(section => {
                const sectionScores = Object.entries(auditData.scores)
                    .filter(([key]) => key.startsWith(section))
                    .map(([, value]) => value);
                
                const sectionTotal = sectionScores.reduce((a, b) => a + b, 0);
                const sectionScoreEl = document.querySelector(`[data-section-score="${section}"]`);
                
                if (sectionScoreEl) {
                    sectionScoreEl.textContent = `${sectionTotal}/12`;
                    if (sectionScores.length === 3) {
                        sectionScoreEl.classList.add('complete');
                    } else {
                        sectionScoreEl.classList.remove('complete');
                    }
                }
            });
            
            const progressPercent = (scoredCount / TOTAL_CRITERIA) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            
            if (!auditeur) {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
                submitText.textContent = 'Renseigner l\'auditeur';
            } else if (!zone) {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
                submitText.textContent = 'Sélectionner une zone';
            } else if (scoredCount < TOTAL_CRITERIA) {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
                submitText.textContent = `${TOTAL_CRITERIA - scoredCount} critère${(TOTAL_CRITERIA - scoredCount) > 1 ? 's' : ''} restant${(TOTAL_CRITERIA - scoredCount) > 1 ? 's' : ''}`;
            } else {
                submitBtn.disabled = false;
                submitBtn.classList.add('ready');
                submitText.textContent = 'Enregistrer';
            }
        }
        
        // ═══════════════════════════════════════════════════════════════
        // SOUMISSION
        // ═══════════════════════════════════════════════════════════════
        
        // Ordre des critères pour le tableau scores (colonnes G à U)
        const CRITERIA_ORDER = [
            'seiri_1', 'seiri_2', 'seiri_3',
            'seiton_1', 'seiton_2', 'seiton_3',
            'seiso_1', 'seiso_2', 'seiso_3',
            'seiketsu_1', 'seiketsu_2', 'seiketsu_3',
            'shitsuke_1', 'shitsuke_2', 'shitsuke_3'
        ];
        
        function submitAudit() {
            const level = auditData.level;
            const zone = document.getElementById('zone').value;
            const auditeur = document.getElementById('auditeur').value.trim();
            const comment = document.getElementById('comment-global').value.trim();
            const now = new Date();
            
            // Vérification avec animation sur champs manquants
            let hasError = false;
            
            // Vérifier auditeur
            const auditeurGroup = document.getElementById('auditeur').closest('.form-group');
            if (!auditeur) {
                highlightMissingField(auditeurGroup);
                hasError = true;
            }
            
            // Vérifier zone
            const zoneGroup = document.getElementById('zone').closest('.form-group');
            if (!zone) {
                highlightMissingField(zoneGroup);
                hasError = true;
            }
            
            if (hasError) {
                showToast('Veuillez remplir les champs obligatoires', 'error');
                // Scroll vers le haut pour voir les champs
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }
            
            if (Object.keys(auditData.scores).length < TOTAL_CRITERIA) {
                showToast('Veuillez compléter tous les critères', 'error');
                return;
            }
            
            // Vérifier les responsables d'action (si action remplie, responsable doit être valide)
            let invalidResponsable = null;
            for (const [critere, data] of Object.entries(auditData.actions)) {
                if (data.action && data.action.trim()) {
                    // Il y a une action, vérifier le responsable
                    if (!data.responsable || !data.responsable.trim()) {
                        invalidResponsable = { critere, reason: 'missing' };
                        break;
                    }
                    if (!AUDITEURS.includes(data.responsable.trim())) {
                        invalidResponsable = { critere, reason: 'invalid' };
                        break;
                    }
                }
            }
            
            if (invalidResponsable) {
                // Trouver et ouvrir la section concernée
                const card = document.querySelector(`[data-criteria="${invalidResponsable.critere}"]`);
                if (card) {
                    const section = card.closest('.s-section');
                    if (section) section.classList.remove('collapsed');
                    
                    const actionBlock = card.querySelector('.action-block');
                    if (actionBlock) actionBlock.classList.add('visible');
                    
                    const respField = card.querySelector('.action-responsable');
                    if (respField) {
                        respField.focus();
                        respField.classList.add('field-error');
                        setTimeout(() => respField.classList.remove('field-error'), 2000);
                    }
                    
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                const message = invalidResponsable.reason === 'missing' 
                    ? 'Responsable manquant pour une action' 
                    : 'Responsable non reconnu — choisissez dans la liste';
                showToast(message, 'error');
                return;
            }
            
            const totalScore = Object.values(auditData.scores).reduce((a, b) => a + b, 0);
            const percent = Math.round((totalScore / MAX_SCORE) * 100);
            
            // Récupérer le secteur depuis l'optgroup
            const zoneSelect = document.getElementById('zone');
            const selectedOption = zoneSelect.options[zoneSelect.selectedIndex];
            const secteur = selectedOption.parentElement.label || '';
            
            // Générer ID unique (pour identification interne)
            const auditId = `AUDIT_${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}_${zone.toLowerCase().replace(/[^a-z]/g, '')}`;
            
            // Nom de fichier lisible
            const moisCourt = ['jan', 'fév', 'mar', 'avr', 'mai', 'juin', 'juil', 'août', 'sep', 'oct', 'nov', 'déc'][now.getMonth()];
            const filename = `5S ${zone} - ${now.getDate()} ${moisCourt} ${now.getFullYear()} ${now.getHours()}h${String(now.getMinutes()).padStart(2,'0')}`;
            
            // Scores en tableau ordonné (pour colonnes G à U)
            const scoresArray = CRITERIA_ORDER.map(criteria => auditData.scores[criteria] || 0);
            
            // Actions en tableau (pour feuille Action)
            const actionsArray = Object.entries(auditData.actions)
                .filter(([, data]) => data.action && data.responsable)
                .map(([critere, data]) => ({
                    critere: critere,
                    type: data.type === 'ecart' ? 'Écart aux standards' : 'Élévation des standards',
                    action: data.action,
                    responsable: data.responsable,
                    responsableSP: formatNameForExport(data.responsable)
                }));
            
            // Structure JSON finale
            const jsonData = {
                auditId: auditId,
                date: now.toISOString().split('T')[0],
                auditeur: auditeur,
                auditeurSP: formatNameForExport(auditeur),
                secteur: secteur,
                zone: zone,
                niveau: `Niveau ${level}`,
                scores: scoresArray,
                actions: actionsArray,
                commentaire: comment
            };
            
            // Stocker les données pour l'export
            pendingExport = {
                jsonData: jsonData,
                filename: filename,
                percent: percent,
                zone: zone,
                nbActions: actionsArray.length
            };
            
            // Afficher le résumé dans la popup
            const summary = document.getElementById('export-summary');
            summary.innerHTML = `<strong>${filename}</strong>Score : ${totalScore}/60 (${percent}%)${actionsArray.length > 0 ? ` • ${actionsArray.length} action${actionsArray.length > 1 ? 's' : ''}` : ''}`;
            
            // Ouvrir la popup d'export
            document.getElementById('export-modal').classList.add('visible');
        }
        
        // Données en attente d'export
        let pendingExport = null;
        
        // URL du dossier SharePoint
        const SHAREPOINT_URL = 'https://sartorius.sharepoint.com/:f:/s/OP_SCEContImprovement/IgArceBdZBsHRZU3yh0A_Gj5AVvmw9sd0mfIcHGmv1nVybc?e=BBTfmI';
        
        function initExportModal() {
            // Bouton Télécharger + SharePoint
            document.getElementById('export-sharepoint').addEventListener('click', function() {
                if (!pendingExport) return;
                
                // Télécharger le JSON
                downloadJSON(pendingExport.jsonData, pendingExport.filename);
                
                // Fermer la popup
                closeExportModal();
                
                // Message de succès avec bouton SharePoint
                const actionMsg = pendingExport.nbActions > 0 ? ` — ${pendingExport.nbActions} action${pendingExport.nbActions > 1 ? 's' : ''}` : '';
                showToastWithAction(
                    `Audit exporté — ${pendingExport.percent}%${actionMsg}`,
                    'success',
                    'Ouvrir SharePoint 5S',
                    () => window.open(SHAREPOINT_URL, '_blank')
                );
                
                // Reset après délai
                setTimeout(() => {
                    resetForm();
                }, 5000);
            });
            
            // Bouton Envoyer par mail
            document.getElementById('export-mail').addEventListener('click', function() {
                if (!pendingExport) return;
                
                // Construire le corps du mail
                const data = pendingExport.jsonData;
                const jsonCompact = JSON.stringify(data);
                
                const body = `Bonjour,

Veuillez trouver ci-dessous les données de l'audit 5S.

Zone : ${data.zone}
Date : ${data.date}
Auditeur : ${data.auditeur}
Niveau : ${data.niveau}
Score : ${data.scores.reduce((a, b) => a + b, 0)}/60 (${pendingExport.percent}%)
Actions : ${pendingExport.nbActions}



════════════════════════════════════
⚠️ NE PAS MODIFIER CI-DESSOUS
════════════════════════════════════
${jsonCompact}
════════════════════════════════════`;

                const subject = `[AUDIT5S] ${pendingExport.filename}`;
                const mailto = `mailto:${EMAIL_DEST}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Ouvrir le client mail
                window.location.href = mailto;
                
                // Fermer la popup
                closeExportModal();
                
                // Message de succès
                showToast('Mail préparé — vérifiez et envoyez', 'success');
                
                // Reset après délai
                setTimeout(() => {
                    resetForm();
                }, 1500);
            });
            
            // Bouton Annuler
            document.getElementById('export-cancel').addEventListener('click', closeExportModal);
            
            // Clic sur overlay pour fermer
            document.getElementById('export-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeExportModal();
                }
            });
        }
        
        // Email destinataire
        const EMAIL_DEST = 'guillaume.delavault1@sartorius.com';
        
        function closeExportModal() {
            document.getElementById('export-modal').classList.remove('visible');
            // On ne reset PAS pendingExport ni le formulaire ici
            // L'utilisateur peut re-cliquer sur Enregistrer
        }
        
        // Convertit "Nom Prénom" en "Nom, Prénom" pour SharePoint
        function formatNameForExport(name) {
            if (!name) return '';
            const parts = name.trim().split(' ');
            if (parts.length < 2) return name;
            const nom = parts[0];
            const prenom = parts.slice(1).join(' ');
            return `${nom}, ${prenom}`;
        }
        
        function downloadJSON(data, filename) {
            const jsonString = JSON.stringify(data, null, 2);
            // Ajouter BOM UTF-8 pour garantir l'encodage
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + jsonString], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function highlightMissingField(element) {
            // Enlever la classe si déjà présente (pour relancer l'animation)
            element.classList.remove('missing');
            // Force reflow pour relancer l'animation
            void element.offsetWidth;
            // Ajouter la classe
            element.classList.add('missing');
            
            // Retirer après l'animation
            setTimeout(() => {
                element.classList.remove('missing');
            }, 2000);
        }
        
        function checkMissingFields() {
            const auditeur = document.getElementById('auditeur').value.trim();
            const zone = document.getElementById('zone').value;
            
            const auditeurGroup = document.getElementById('auditeur').closest('.form-group');
            const zoneGroup = document.getElementById('zone').closest('.form-group');
            
            if (!auditeur) {
                highlightMissingField(auditeurGroup);
            }
            
            if (!zone) {
                highlightMissingField(zoneGroup);
            }
        }
        
        function checkIncompleteActions() {
            for (const [critere, data] of Object.entries(auditData.actions)) {
                if (data.action && data.action.trim()) {
                    // Il y a une action, vérifier le responsable
                    const hasValidResponsable = data.responsable && 
                                                data.responsable.trim() && 
                                                AUDITEURS.includes(data.responsable.trim());
                    
                    if (!hasValidResponsable) {
                        // Faire clignoter la pastille
                        const card = document.querySelector(`[data-criteria="${critere}"]`);
                        if (card) {
                            const badge = card.querySelector('.action-badge');
                            if (badge) {
                                badge.classList.add('incomplete-action');
                                setTimeout(() => badge.classList.remove('incomplete-action'), 1500);
                            }
                        }
                    }
                }
            }
        }
        

        // ═══════════════════════════════════════════════════════════════
        // UTILITAIRES
        // ═══════════════════════════════════════════════════════════════
        
        function resetForm(keepContext = false) {
            // Toujours garder l'auditeur (mémorisé)
            // Garder zone et niveau si demandé
            if (!keepContext) {
                document.getElementById('zone').value = '';
                document.getElementById('level-input').value = 1;
                auditData.level = 1;
                updateLevelLabels(1);
            }
            
            document.getElementById('comment-global').value = '';
            
            document.querySelectorAll('.score-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.criteria-card').forEach(card => card.classList.remove('scored'));
            
            // Réinitialiser toutes les pastilles d'action
            document.querySelectorAll('.action-badge').forEach(badge => {
                badge.classList.remove('has-action', 'needs-action', 'suggest-elevation');
            });
            
            document.querySelectorAll('.action-block').forEach(block => {
                block.classList.remove('visible');
                block.querySelectorAll('.action-type-btn').forEach(btn => {
                    btn.classList.toggle('selected', btn.dataset.type === 'ecart');
                });
                const actionField = block.querySelector('.action-text');
                const responsableField = block.querySelector('.action-responsable');
                if (actionField) actionField.value = '';
                if (responsableField) responsableField.value = '';
            });
            
            document.querySelectorAll('.s-section').forEach((section, index) => {
                if (index === 0) {
                    section.classList.remove('collapsed');
                } else {
                    section.classList.add('collapsed');
                }
            });
            
            auditData.scores = {};
            auditData.actions = {};
            
            // Effacer l'indicateur de brouillon
            document.getElementById('draft-indicator').textContent = '';
            
            updateFormState();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function toggleOptional(element) {
            const content = element.nextElementSibling;
            content.classList.toggle('visible');
        }
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast visible ' + type;
            
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 3000);
        }
        
        function showToastWithAction(message, type, btnText, btnAction) {
            const toast = document.getElementById('toast');
            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-btn" id="toast-action-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                    ${btnText}
                </button>
            `;
            toast.className = 'toast visible ' + type;
            
            document.getElementById('toast-action-btn').addEventListener('click', function() {
                btnAction();
                toast.classList.remove('visible');
            });
            
            // Reste visible jusqu'au clic sur le bouton
        }
        
        function reportProblem() {
            const email = 'guillaume.delavault1@sartorius.com';
            const subject = encodeURIComponent('[Audit 5S] Signalement');
            const body = encodeURIComponent(`Bonjour,

Je souhaite signaler :
☐ Mon nom est absent de la liste des auditeurs
☐ Un bug dans l'application
☐ Une suggestion d'amélioration
☐ Autre

Description :




Cordialement`);
            
            window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
        }
        
        // ═══════════════════════════════════════════════════════════════
        // POPUP INFO
        // ═══════════════════════════════════════════════════════════════
        
        const infoData = {
            // Sections
            seiri: { title: "1S — Trier", text: "Éliminer tout ce qui est inutile du poste de travail. Distinguer ce qui est nécessaire de ce qui ne l'est pas." },
            seiton: { title: "2S — Ranger", text: "Organiser l'espace pour que chaque objet ait une place définie et soit facilement accessible." },
            seiso: { title: "3S — Nettoyer", text: "Nettoyer régulièrement et inspecter pour détecter les anomalies avant qu'elles ne deviennent des problèmes." },
            seiketsu: { title: "4S — Standardiser", text: "Définir des règles claires et les rendre visibles pour maintenir les 3 premiers S." },
            shitsuke: { title: "5S — Pérenniser", text: "Respecter les standards établis et les améliorer continuellement." },
            // Critères
            seiri_1: { title: "Obsolètes identifiés", text: "Vérifier que les produits périmés, outils cassés ou documents obsolètes sont identifiés et éliminés." },
            seiri_2: { title: "Objets inutiles", text: "Aucun objet non nécessaire au travail quotidien ne doit encombrer la zone." },
            seiri_3: { title: "Affichages obsolètes", text: "Les affichages périmés, procédures obsolètes ou informations caduques doivent être retirés." },
            seiton_1: { title: "Emplacement identifié", text: "Chaque outil, produit ou document doit avoir un emplacement clairement identifié (marquage, étiquette)." },
            seiton_2: { title: "Rangé à sa place", text: "Tous les éléments doivent être rangés à leur place désignée, rien ne traîne." },
            seiton_3: { title: "Fréquence d'utilisation", text: "Les objets les plus utilisés doivent être les plus accessibles (ergonomie)." },
            seiso_1: { title: "Sols, murs, vitres", text: "Sols sans taches, murs et vitres propres, pas de poussière visible." },
            seiso_2: { title: "Équipements propres", text: "Machines, établis et équipements nettoyés et en bon état visuel." },
            seiso_3: { title: "Matériel de nettoyage", text: "Balais, chiffons, produits de nettoyage disponibles et rangés à leur place." },
            seiketsu_1: { title: "Standards affichés", text: "Les procédures 5S et consignes de sécurité sont documentées et visibles dans la zone." },
            seiketsu_2: { title: "Zone polyvalente", text: "La zone peut accueillir différentes activités sans réorganisation majeure." },
            seiketsu_3: { title: "Environnement sûr", text: "Pas de danger apparent, EPI requis disponibles et en bon état." },
            shitsuke_1: { title: "Standards Sartorius", text: "Les standards Sartorius (qualité, sécurité, environnement) sont appliqués au quotidien." },
            shitsuke_2: { title: "Écarts traités", text: "Les actions correctives des audits précédents ont été mises en œuvre." },
            shitsuke_3: { title: "Planning respecté", text: "Les audits 5S sont réalisés selon le planning défini." }
        };
        
        function initInfoPopup() {
            const popup = document.getElementById('info-popup');
            const closeBtn = document.getElementById('info-popup-close');
            
            // Fermer la popup
            closeBtn.addEventListener('click', closeInfoPopup);
            popup.addEventListener('click', function(e) {
                if (e.target === popup) closeInfoPopup();
            });
            
            // Ouvrir au clic sur les pastilles info
            document.querySelectorAll('.info-badge').forEach(badge => {
                badge.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const infoId = this.dataset.info;
                    if (infoId && infoData[infoId]) {
                        openInfoPopup(infoData[infoId].title, infoData[infoId].text);
                    }
                });
            });
        }
        
        function openInfoPopup(title, text) {
            document.getElementById('info-popup-title').textContent = title;
            document.getElementById('info-popup-body').textContent = text;
            document.getElementById('info-popup').classList.add('visible');
        }
        
        function closeInfoPopup() {
            document.getElementById('info-popup').classList.remove('visible');
        }
        
        document.querySelectorAll('.optional-toggle').forEach(toggle => {
            toggle.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleOptional(this);
                }
            });
        });
        
        // ═══════════════════════════════════════════════════════════════
        // MENU HAMBURGER
        // ═══════════════════════════════════════════════════════════════
        
        const menuBtn = document.getElementById('menu-btn');
        const menuPopup = document.getElementById('menu-popup');
        const menuOverlay = document.getElementById('menu-overlay');
        
        menuBtn.addEventListener('click', toggleMenu);
        menuOverlay.addEventListener('click', closeMenu);
        
        function toggleMenu() {
            const isOpen = menuPopup.classList.contains('visible');
            if (isOpen) {
                closeMenu();
            } else {
                openMenu();
            }
        }
        
        function openMenu() {
            menuBtn.classList.add('active');
            menuPopup.classList.add('visible');
            menuOverlay.classList.add('visible');
        }
        
        function closeMenu() {
            menuBtn.classList.remove('active');
            menuPopup.classList.remove('visible');
            menuOverlay.classList.remove('visible');
        }
        
        function menuAction(action) {
            closeMenu();
            
            switch(action) {
                case 'save':
                    saveDraft();
                    break;
                case 'load':
                    showConfirmModal(
                        'Charger le brouillon',
                        'Les données actuelles seront remplacées.',
                        'warning',
                        'Charger',
                        loadDraft
                    );
                    break;
                case 'reset':
                    showConfirmModal(
                        'Réinitialiser l\'audit',
                        'Les scores et actions seront effacés.<br>L\'auditeur, la zone et le niveau seront conservés.',
                        'danger',
                        'Réinitialiser',
                        function() {
                            resetForm(true);
                            showToast('Audit réinitialisé', 'info');
                        },
                        true
                    );
                    break;
                case 'sharepoint':
                    window.open(SHAREPOINT_URL, '_blank');
                    break;
                case 'darkmode':
                    toggleDarkMode();
                    break;
                case 'guide':
                    showGuide();
                    break;
                case 'report':
                    reportProblem();
                    break;
                case 'about':
                    showAbout();
                    break;
            }
        }
        
        // ═══════════════════════════════════════════════════════════════
        // MODALE DE CONFIRMATION
        // ═══════════════════════════════════════════════════════════════
        
        let confirmCallback = null;
        
        function showConfirmModal(title, text, type, btnText, callback, isDanger = false) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-text').innerHTML = text;
            
            const icon = document.getElementById('confirm-icon');
            icon.className = 'confirm-modal-icon ' + type;
            
            const confirmBtn = document.getElementById('confirm-btn');
            confirmBtn.textContent = btnText;
            confirmBtn.className = 'confirm-modal-btn ' + (isDanger ? 'danger' : 'confirm');
            
            confirmCallback = callback;
            document.getElementById('confirm-modal').classList.add('visible');
        }
        
        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('visible');
            confirmCallback = null;
        }
        
        document.getElementById('confirm-btn').addEventListener('click', function() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmModal();
        });
        
        document.getElementById('confirm-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfirmModal();
            }
        });
        
        // ═══════════════════════════════════════════════════════════════
        // BROUILLON - SAUVEGARDE / CHARGEMENT
        // ═══════════════════════════════════════════════════════════════
        
        function saveDraft() {
            const now = new Date();
            const midnight = new Date(now);
            midnight.setHours(23, 59, 59, 999);
            
            const draft = {
                level: auditData.level,
                scores: auditData.scores,
                actions: auditData.actions,
                zone: document.getElementById('zone').value,
                auditeur: document.getElementById('auditeur').value,
                comment: document.getElementById('comment-global').value,
                savedAt: now.toISOString(),
                expiresAt: midnight.toISOString()
            };
            
            localStorage.setItem('audit5s_draft', JSON.stringify(draft));
            updateDraftIndicator(now);
            showToast('Brouillon enregistré jusqu\'à la fin de la journée', 'success');
        }
        
        function loadDraft() {
            const saved = localStorage.getItem('audit5s_draft');
            if (!saved) {
                showToast('Aucun brouillon trouvé', 'info');
                return;
            }
            
            const draft = JSON.parse(saved);
            
            // Vérifier expiration
            if (draft.expiresAt && new Date() > new Date(draft.expiresAt)) {
                localStorage.removeItem('audit5s_draft');
                updateDraftIndicator(null);
                showToast('Le brouillon a expiré', 'info');
                return;
            }
            
            // Restaurer les valeurs
            document.getElementById('zone').value = draft.zone || '';
            document.getElementById('auditeur').value = draft.auditeur || '';
            document.getElementById('comment-global').value = draft.comment || '';
            document.getElementById('level-input').value = draft.level || 1;
            
            auditData.level = draft.level || 1;
            auditData.scores = draft.scores || {};
            auditData.actions = draft.actions || {};
            
            // Restaurer les boutons de score
            Object.entries(auditData.scores).forEach(([criteria, score]) => {
                const card = document.querySelector(`[data-criteria="${criteria}"]`);
                if (card) {
                    card.classList.add('scored');
                    const btn = card.querySelector(`[data-score="${score}"]`);
                    if (btn) btn.classList.add('selected');
                }
            });
            
            // Restaurer les actions
            Object.entries(auditData.actions).forEach(([criteria, actionData]) => {
                const card = document.querySelector(`[data-criteria="${criteria}"]`);
                if (card) {
                    const badge = card.querySelector('.action-badge');
                    const block = card.querySelector('.action-block');
                    if (badge) badge.classList.add('has-action');
                    if (block) {
                        block.classList.add('visible');
                        const typeBtn = block.querySelector(`[data-type="${actionData.type}"]`);
                        if (typeBtn) {
                            block.querySelectorAll('.action-type-btn').forEach(b => b.classList.remove('selected'));
                            typeBtn.classList.add('selected');
                        }
                        const textField = block.querySelector('.action-text');
                        const respField = block.querySelector('.action-responsable');
                        if (textField) textField.value = actionData.text || '';
                        if (respField) respField.value = actionData.responsable || '';
                    }
                }
            });
            
            updateLevelLabels(auditData.level);
            updateFormState();
            
            const savedDate = new Date(draft.savedAt);
            updateDraftIndicator(savedDate, true);
            showToast('Brouillon chargé', 'success');
        }
        
        function updateDraftIndicator(date, isLoaded = false) {
            const indicator = document.getElementById('draft-indicator');
            if (!date) {
                indicator.textContent = '';
                return;
            }
            
            const timeStr = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            const today = new Date();
            const isToday = date.toDateString() === today.toDateString();
            
            if (isLoaded) {
                if (isToday) {
                    indicator.textContent = `Brouillon de ${timeStr} chargé`;
                } else {
                    const dateStr = date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' });
                    indicator.textContent = `Brouillon du ${dateStr} à ${timeStr} chargé`;
                }
            } else {
                indicator.textContent = `Brouillon sauvegardé à ${timeStr}`;
            }
        }
        
        // Vérifier s'il y a un brouillon au chargement
        function checkExistingDraft() {
            const saved = localStorage.getItem('audit5s_draft');
            if (saved) {
                const draft = JSON.parse(saved);
                if (draft.expiresAt && new Date() > new Date(draft.expiresAt)) {
                    localStorage.removeItem('audit5s_draft');
                }
            }
        }
        checkExistingDraft();
        
        // ═══════════════════════════════════════════════════════════════
        // MODE SOMBRE
        // ═══════════════════════════════════════════════════════════════
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('audit5s_darkmode', isDark);
            updateDarkModeButton(isDark);
            showToast(isDark ? 'Thème sombre activé' : 'Thème clair activé', 'info');
        }
        
        function updateDarkModeButton(isDark) {
            const btn = document.getElementById('darkmode-btn');
            const moonIcon = btn.querySelector('.icon-moon');
            const sunIcon = btn.querySelector('.icon-sun');
            const label = btn.querySelector('.darkmode-label');
            
            if (isDark) {
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'block';
                label.textContent = 'Thème clair';
            } else {
                moonIcon.style.display = 'block';
                sunIcon.style.display = 'none';
                label.textContent = 'Thème sombre';
            }
        }
        
        // Charger préférence mode sombre au démarrage
        if (localStorage.getItem('audit5s_darkmode') === 'true') {
            document.body.classList.add('dark-mode');
            updateDarkModeButton(true);
        }
        
        // ═══════════════════════════════════════════════════════════════
        // GUIDE ET À PROPOS
        // ═══════════════════════════════════════════════════════════════
        
        function showGuide() {
            const guideContent = `
                <div style="text-align: left; line-height: 1.6;">
                    <p><strong>1S — Trier (Seiri)</strong><br>Éliminer tout ce qui est inutile du poste de travail.</p>
                    <p><strong>2S — Ranger (Seiton)</strong><br>Organiser l'espace pour que chaque objet ait une place définie.</p>
                    <p><strong>3S — Nettoyer (Seiso)</strong><br>Nettoyer régulièrement et inspecter pour détecter les anomalies.</p>
                    <p><strong>4S — Standardiser (Seiketsu)</strong><br>Définir des règles claires et les rendre visibles.</p>
                    <p><strong>5S — Pérenniser (Shitsuke)</strong><br>Respecter les standards établis et les améliorer continuellement.</p>
                </div>
            `;
            document.getElementById('info-popup-title').textContent = 'Guide 5S';
            document.getElementById('info-popup-body').innerHTML = guideContent;
            document.getElementById('info-popup').classList.add('visible');
        }
        
        function showAbout() {
            const aboutContent = `
                <div style="text-align: left; line-height: 1.6;">
                    <p><strong>Audit 5S</strong><br>Application d'audit qualité pour le suivi des zones de production.</p>
                    <p><strong>Version</strong> 1.0</p>
                    <p><strong>Contact</strong><br>Continuous Improvement — Sartorius Chromatography Equipment, Pompey</p>
                </div>
            `;
            document.getElementById('info-popup-title').textContent = 'À propos';
            document.getElementById('info-popup-body').innerHTML = aboutContent;
            document.getElementById('info-popup').classList.add('visible');
        }
    </script>
</body>
</html>
